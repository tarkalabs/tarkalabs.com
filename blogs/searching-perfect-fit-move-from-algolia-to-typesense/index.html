<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Searching For The Perfect Fit: Our Move from Algolia to Typesense · Tarka Labs - Tarka Labs</title><meta name="gridsome:hash" content="f6fa4d08b23fbd735401f414f27e460c04f21e9d"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="viewport" content="width=device-width, initial-scale=1.0"><meta data-vue-tag="ssr" property="og:title" content="Searching For The Perfect Fit: Our Move from Algolia to Typesense · Tarka Labs"><meta data-vue-tag="ssr" property="og:description" content="Our search for an open-source, cost-effective, scalable, and self-hosted solution led us to Typesense, an alternative to the very popular Algolia."><meta data-vue-tag="ssr" property="og:image" content="/assets/img/searching-perfect-fit-move-from-algolia-to-typesense.72ee03a2.webp"><meta data-vue-tag="ssr" property="og:image:height" content="627"><meta data-vue-tag="ssr" property="og:image:width" content="1200"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.92f6d0f06feb6aec5e019521ff224fd8.png"><link rel="preload" href="/assets/css/0.styles.ff22d50a.css" as="style"><link rel="preload" href="/assets/js/app.5034332d.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--blog-vue.80bca3bd.js" as="script"><link rel="stylesheet" href="/assets/css/0.styles.ff22d50a.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
    <meta
      name="google-site-verification"
      content="j7cLUK-kxGEpMOY7valSkamH4kQe_l38yMMAXbpk19U"
    />
    <noscript>
      <div class="noscript-container">
        <a href="/" class="noscript-logo">Tarka <br />_Labs</a>
        <div class="noscript-text-container">
          <h1>Uh oh! Looks like <span>JavaScript</span> is disabled.</h1>
          <p>
            Bitman requires <span>JavaScript</span> to fuel his thirst to end
            bad UX and lazy design, which is necessary to give you the best
            viewing experience possible. Please enable it to continue to our
            website.
          </p>
        </div>
      </div>
    </noscript>
  </head>

  <body >
    <div><div id="app" data-server-rendered="true" data-v-b5a9baaa><div data-v-b5a9baaa><div id="banner-section" data-v-b5a9baaa><div class="banner" style="background:;display:none;" data-v-b5a9baaa><div class="layout" data-v-b5a9baaa><div data-v-b5a9baaa></div><div class="hero heading-size-5" style="color:#ffffff;" data-v-b5a9baaa></div><div data-v-b5a9baaa></div></div></div><div data-v-b5a9baaa></div></div><div class="sidebar" data-v-d6d2017e data-v-b5a9baaa><div class="nav" data-v-d6d2017e><div class="fixed" data-v-d6d2017e><a href="/" data-v-9b1a4c9c data-v-d6d2017e> TARKA<br data-v-9b1a4c9c>_LABS </a><div class="menu" data-v-50705736 data-v-d6d2017e><div class="control" style="stroke:black;" data-v-50705736><div class="spinner heading-size-9" data-v-02ea7230 data-v-50705736><span class="side-menu-symbol" data-v-02ea7230><span class="menu-symbol rotate180t90" data-v-02ea7230><svg height="10" width="10" data-v-02ea7230><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-02ea7230></line></svg></span><span class="menu-symbol rotate90t0" data-v-02ea7230><svg height="10" width="10" data-v-02ea7230><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-02ea7230></line></svg></span></span><span style="vertical-align: middle" data-v-02ea7230> menu </span></div><div class="active-page body-jetbrains-size-11 fade-in" data-v-128e5feb data-v-50705736>
  
</div></div><div class="items hidden" data-v-50705736><ul class="main-nav" data-v-244aa462 data-v-50705736><div class="primary fadeOut sidebar" data-v-244aa462><li data-v-244aa462><a href="/music-biz" data-v-244aa462>/MusicBiz</a></li><li data-v-244aa462><a href="/genai" data-v-244aa462>/GenAI</a></li><li data-v-244aa462><a href="https://solutions.tarkalabs.com/design/" target="_self" data-v-244aa462>/Design</a></li><li data-v-244aa462><a href="/develop" data-v-244aa462>/Develop</a></li><li data-v-244aa462><a href="/case-studies" data-v-244aa462>
        /Case_Studies
      </a></li><li data-v-244aa462><a href="/careers" data-v-244aa462>/Careers</a></li><li data-v-244aa462><a href="/about" data-v-244aa462>/About</a></li><li data-v-244aa462><a href="/contact" data-v-244aa462>/Contact</a></li></div></ul><ul class="sub body-jetbrains-size-11 fadeOut sidebar" data-v-3cc3824e data-v-50705736><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul></div></div><a href="/contact" class="heading-size-9" data-v-573e12d8 data-v-d6d2017e>
  Get in<br data-v-573e12d8>touch<span class="arrow" data-v-573e12d8>-&gt;</span></a></div></div><!----></div><div class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="blog-details-page" data-v-996dafb6><div class="inner-section" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>
        /web - 5 min read
      </p><h1 class="title" data-v-996dafb6>Searching For The Perfect Fit: Our Move from Algolia to Typesense</h1><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/shamil.116f5579.png" alt="Shamil Siddique" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Shamil Siddique</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div></div><img src="/assets/img/searching-perfect-fit-move-from-algolia-to-typesense.72ee03a2.webp" alt="Searching For The Perfect Fit: Our Move from Algolia to Typesense" class="header-img" data-v-996dafb6><div class="toc-wrapper" data-v-996dafb6><h2 class="heading-size-7" data-v-996dafb6>Table of contents</h2><div class="toc" data-v-996dafb6><a href="#content" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/01</p><p data-v-996dafb6>Intro</p></a><a href="#toc-section-1" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/02</p><p data-v-996dafb6>What exactly is Typesense?</p></a><a href="#toc-section-2" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/03</p><p data-v-996dafb6>The Algolia-based architecture</p></a><a href="#toc-section-3" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/04</p><p data-v-996dafb6>Bringing in Typesense</p></a><a href="#toc-section-4" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/05</p><p data-v-996dafb6>Cleaning up</p></a><a href="#toc-section-5" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/06</p><p data-v-996dafb6>And that’s all, folks!</p></a></div></div><div id="content" class="content" data-v-996dafb6><p>Recently, while discussing an issue related to search in ServerlessForms, we discussed <a href="https://www.algolia.com/" target="_blank" rel="nofollow noopener noreferrer">Algolia search</a> and its advantages. We realized that the decision to adopt Algolia search came a few years back, and we have never looked at the competition that came afterward.</p>
<p>So, being the cutting edge techies that we are, we started looking into other modern options in the database search domain that provided similar or better features, hopefully with a lower operational cost.</p>
<p>This is when we stumbled upon <a href="https://typesense.org/" target="_blank" rel="nofollow noopener noreferrer">Typesense</a>, an open source alternative for Algolia search, which works similarly. This article gives a brief peek into the changes we made for moving to Typesense as our search service.</p>
<h1 id="toc-section-1"><a href="#what-exactly-is-typesense" aria-hidden="true"><span class="icon icon-link"></span></a>What exactly is Typesense?</h1>
<p>In May 2023, if you haven’t heard about Typesense, it is not surprising. Sure, it’s younger and less popular (maybe?) than Algolia search. But on the other hand, it is open-source, has a cheaper cloud option and can be self-hosted if you have the hardware to spare. More than that, it is packed with all the features that Algolia provides, if not more.</p>
<p><strong>Bonus</strong>: Their website has a <a href="https://typesense.org/typesense-vs-algolia-vs-elasticsearch-vs-meilisearch/" target="_blank" rel="nofollow noopener noreferrer">dedicated page</a> for comparison against Algolia, ElasticSearch and Meilisearch.</p>
<h1 id="toc-section-2"><a href="#the-algolia-based-architecture" aria-hidden="true"><span class="icon icon-link"></span></a>The Algolia-based architecture</h1>
<p>Before going through the changes that we made, let’s have an understanding of how Algolia was integrated into our application.</p>
<p>We had an MVC code structure set up, with a lot of helper files and service files. Our search-related functionalities were defined in an <strong><em>algolia-client.js</em></strong> file. If you ignore the unrelated logic and complexities, our controller looked similar to this:</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> algolia <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./algolia-client"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> record <span class="token operator">=</span> <span class="token keyword">await</span> model<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  algolia<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">await</span> model<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  algolia<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> hits <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> algolia<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> hits<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>In our <strong><em>algolia-client.js</em></strong> file, we were using the <a href="https://www.npmjs.com/package/algoliasearch" target="_blank" rel="nofollow noopener noreferrer">algoliasearch npm package</a> to abstract out the intricacies of our Algolia cloud APIs.</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> algoliasearch <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"algoliasearch"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token function">algoliasearch</span><span class="token punctuation">(</span><span class="token constant">ALGOLIA_APP_ID</span><span class="token punctuation">,</span> <span class="token constant">ALGOLIA_ADMIN_API_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> index <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">initIndex</span><span class="token punctuation">(</span><span class="token constant">ALGOLIA_INDEX_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The index was then used by 3 methods to provide search, add and update functionalities, which were exported for use in the controller. So, the codebase in the file, in a simplified form, looked like this:</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">search</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">query</span><span class="token punctuation">)</span> <span class="token operator">=></span> index<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>query<span class="token punctuation">)</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>record<span class="token punctuation">,</span> <span class="token literal-property property">objectId</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">object-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> index<span class="token punctuation">.</span><span class="token function">saveObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

exports<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>data<span class="token punctuation">,</span> <span class="token literal-property property">objectId</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">object-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> index<span class="token punctuation">.</span><span class="token function">partialUpdateObject</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<h1 id="toc-section-3"><a href="#bringing-in-typesense" aria-hidden="true"><span class="icon icon-link"></span></a>Bringing in Typesense</h1>
<p>The first step was easy — <a href="https://www.npmjs.com/package/typesense" target="_blank" rel="nofollow noopener noreferrer">typesense npm package</a> for a bit of API abstraction.</p>
<div class="gridsome-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> typesense</code></pre></div>
<p>To stay true to the current file structure, we created a <strong><em>typesense-client.js</em></strong> file. And that’s when we realized that configuring typesense was the hard part. Typesense requires a bit more configuration than Algolia.</p>
<p><strong>Typesense supports a cluster of nodes</strong></p>
<p>Typesense supports clusters on the cloud as well as in self-hosted setups. So while configuring, they expect an array of available nodes. Since we were using only one node, we had to specify a single element array.</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> Typesense <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"typesense"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token constant">NODES</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token constant">TYPESENSE_HOST</span><span class="token punctuation">,</span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token constant">PORT</span><span class="token punctuation">,</span> <span class="token literal-property property">protocol</span><span class="token operator">:</span> <span class="token constant">PROTOCOL</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Typesense<span class="token punctuation">.</span>Client</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">nodes</span><span class="token operator">:</span> <span class="token constant">NODES</span><span class="token punctuation">,</span>
  <span class="token literal-property property">apiKey</span><span class="token operator">:</span> <span class="token constant">API_KEY</span><span class="token punctuation">,</span>
  <span class="token literal-property property">connectionTimeoutSeconds</span><span class="token operator">:</span> <span class="token constant">TIMEOUT_PERIOD</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>You can read more about Typesense clusters in <a href="https://typesense.org/docs/guide/high-availability.html" target="_blank" rel="nofollow noopener noreferrer">this docs page</a>.</p>
<p><strong>Typesense recommends defining collection schema</strong></p>
<p>Typesense’s collection has a role similar to an Algolia index. But Typesense recommends pre-defining the schema for records that are going to be stored in a collection. In the schema, we can specify which fields need to be indexed or sorted, and which fields are optional, etc. We can also ask a field type to be automatically inferred by setting the type property as <strong><em>auto</em></strong>. An example schema would be:</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">COLLECTION_SCHEMA</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"optional_info"</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"auto"</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">optional</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">"created_at"</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span> <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">sort</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<p>We had a good idea about some of the top-level fields in our collection. So, we stuck with a predefined schema, and set <strong><em>type: object</em></strong> for some of the fields which were objects with no set structure.</p>
<p>If we did not want to pre-define a schema, we would have defined the schema using a wildcard name and auto type as follows.</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> <span class="token constant">COLLECTION_SCHEMA</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">".*"</span><span class="token punctuation">,</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"auto"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<p>Moving on, setting up the collection looked like this.</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js">client
  <span class="token punctuation">.</span><span class="token function">collections</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token constant">COLLECTION_NAME</span><span class="token punctuation">,</span>
    <span class="token literal-property property">enable_nested_fields</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">fields</span><span class="token operator">:</span> <span class="token constant">COLLECTION_SCHEMA</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=></span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> collection <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">collections</span><span class="token punctuation">(</span><span class="token constant">COLLECTION_NAME</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Refer to the <a href="https://typesense.org/docs/0.24.0/api/collections.html#create-a-collection" target="_blank" rel="nofollow noopener noreferrer">Collections section</a> in the docs for a more in-depth description of collections.</p>
<p><strong>Typesense’s collection is similar to an Algolia index</strong></p>
<p>Typesense collections are similar to Algolia indices in a way. They both store a set of records. In Typesense, these records are called <strong>documents</strong>, and most of the methods are called on top of the <strong><em>documents()</em></strong> method.</p>
<p>The search method required an object with <strong><em>q</em></strong> property for the search query and <strong><em>query_by</em></strong> property for the fields that the query should be searched in. It also had other optional properties for pagination, filtration and sorting, which we were using for ServerlessForms. But for our example, <strong><em>q</em></strong> and <strong><em>query_by</em></strong> are all that are required.</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span>search <span class="token operator">=</span> <span class="token punctuation">(</span>query<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> params <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">q</span><span class="token operator">:</span> query<span class="token punctuation">,</span> <span class="token literal-property property">query_by</span><span class="token operator">:</span> <span class="token string">'data'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> collection<span class="token punctuation">.</span><span class="token function">documents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>For defining the add method, we need to set a string type <strong><em>id</em></strong> field as our identifier instead of the <strong><em>objectId</em></strong> field which we set while using Algolia.</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">record</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> document <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span>record<span class="token punctuation">,</span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">document-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>record<span class="token punctuation">.</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> collection<span class="token punctuation">.</span><span class="token function">documents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>For updating the documents, we first access the specific document using its <strong><em>id</em></strong> property and then call the <strong><em>update()</em></strong> method. The update method accepts partial data by default, that is fields in the passed data are either overwritten or added and other fields are not deleted.</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js">exports<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">id<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token operator">=></span>
  collection<span class="token punctuation">.</span><span class="token function">documents</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">document-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>id<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p><strong>The Controller doesn’t change much</strong></p>
<p>Since the search, add and update methods have identical parameters and responses, the controller doesn’t need to be changed much. The import needs to be updated though.</p>
<div class="gridsome-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">const</span> typesense <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./typesense-client"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>In the rest of the controller methods, rename <strong><em>algolia</em></strong> with the newly imported <strong><em>typesense</em></strong>, and we’re good to go!</p>
<h1 id="toc-section-4"><a href="#cleaning-up" aria-hidden="true"><span class="icon icon-link"></span></a>Cleaning up</h1>
<p>After all those steps, it was finally time to clean up. We had to update some tests to remove all references to Algolia and write some tests for our <strong><em>typesense-client.js</em></strong>.</p>
<p>We verified that <strong><em>algolia-client.js</em></strong> is not being imported anywhere, then deleted the file safely. Since that was the only file where the algoliasearch package was being imported, it was safe to uninstall the dependency.</p>
<div class="gridsome-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> uninstall algoliasearch</code></pre></div>
<h1 id="toc-section-5"><a href="#and-thats-all-folks" aria-hidden="true"><span class="icon icon-link"></span></a>And that’s all, folks!</h1>
<p>At the time of writing this post, Typesense is at version 0.24.0.</p>
<p>Compared to Algoliasearch, it might be harder to find solutions when you face blockers — fewer StackOverflow answers, fewer tutorials, etc. And we understand that these can be a huge turndown for a lot of folks.</p>
<p>But do we still recommend Typesense? YES!</p>
<p>We believe that the merits are too large to ignore — it’s open-source, can be self-hosted, and has cheaper cloud offerings. We are sure that the community discussions will only increase as time passes, and then the above-mentioned demerits won’t apply anymore.</p>
<p><strong>An interesting discussion</strong>: <a href="https://news.ycombinator.com/item?id=28884148" target="_blank" rel="nofollow noopener noreferrer">https://news.ycombinator.com/item?id=28884148</a></p>
</div><hr data-v-996dafb6><div class="inner-section" data-v-996dafb6><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/shamil.116f5579.png" alt="Shamil Siddique" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Shamil Siddique</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div><p class="body-opensans-size-9" data-v-996dafb6>He is still thinking what to write about him</p><div class="social-links" data-v-996dafb6><!----><!----><a href="https://medium.com/@shamilsdq" target="_blank" class="heading-size-9" data-v-996dafb6>
          Medium
        </a></div></div><hr data-v-996dafb6><div class="related-articles" data-v-996dafb6><div class="flex-space-between" data-v-996dafb6><p class="heading-size-7" data-v-996dafb6>_related articles</p><a href="/blogs" class="heading-size-9 underline" data-v-996dafb6>View all</a></div><div class="flex-space-between blog-card-wrapper" data-v-996dafb6><a href="/blogs/inserting-millions-of-records-in-java" class="blog-card" data-v-996dafb6><img src="/assets/img/image-2.d7113a92.webp" alt="Inserting Millions of Records in Java: Strategies and Benchmarks" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Inserting Millions of Records in Java: Strategies and Benchmarks</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Kesavan   11 min read
            </p></div></a><a href="/blogs/scaling-royalty-payout-p2" class="blog-card" data-v-996dafb6><img src="/assets/img/default-cover.55254b66.png" alt="" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Scaling Royalty Payouts in Music Distribution: Challenges and Solutions from the Frontlines (Part 2)</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Harman Sohanpal   5 min read
            </p></div></a></div></div><div class="lets-talk" data-v-188e6a71><div class="message heading-size-7" data-v-188e6a71>
    Let’s build digital solutions together.
  </div><div class="action-container" data-v-188e6a71><div class="action-button heading-size-5" data-v-188e6a71><div data-v-188e6a71>Get in touch</div><div class="arrow" data-v-188e6a71>-&gt;</div></div><img src="/assets/img/talk.71d1d2f3.svg" alt="Lenny Face" data-v-188e6a71></div></div></div></div><div data-v-996dafb6></div></div><div id="footer" class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="site-footer" data-v-0a037a4b data-v-b5a9baaa><ul class="main-nav footer" data-v-244aa462 data-v-0a037a4b><div class="primary fadeIn" data-v-244aa462><li data-v-244aa462><a href="/music-biz" data-v-244aa462>/MusicBiz</a></li><li data-v-244aa462><a href="/genai" data-v-244aa462>/GenAI</a></li><li data-v-244aa462><a href="https://solutions.tarkalabs.com/design/" target="_self" data-v-244aa462>/Design</a></li><li data-v-244aa462><a href="/develop" data-v-244aa462>/Develop</a></li><li data-v-244aa462><a href="/case-studies" data-v-244aa462>
        /Case_Studies
      </a></li><li data-v-244aa462><a href="/careers" data-v-244aa462>/Careers</a></li><li data-v-244aa462><a href="/about" data-v-244aa462>/About</a></li><li data-v-244aa462><a href="/contact" data-v-244aa462>/Contact</a></li></div></ul><div class="subnav" data-v-0a037a4b><ul class="sub body-jetbrains-size-11 footer fadeIn" data-v-3cc3824e data-v-0a037a4b><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul><div data-v-fae945d8 data-v-0a037a4b><a href="https://twitter.com/tarkalabs" target="_blank" rel="noopener" class="external" data-v-fae945d8>Twitter</a><a href="https://in.linkedin.com/company/tarka-labs" target="_blank" rel="noopener" class="external" data-v-fae945d8>LinkedIn</a></div><div class="sedin" data-v-0a037a4b><a href="https://sedintechnologies.com/" target="_blank" rel="noopener" class="external" data-v-0a037a4b>Tarka Labs is a division of Sedin Technologies</a></div></div></div></div><div data-v-996dafb6></div></div></div></div></div>
    <script src="/assets/js/app.5034332d.js" defer></script><script src="/assets/js/page--src--templates--blog-vue.80bca3bd.js" defer></script><script data-vue-tag="ssr" src="https://unpkg.com/@lottiefiles/lottie-player@0.4.0/dist/lottie-player.js" data-body="true"></script>
  </body>
</html>
