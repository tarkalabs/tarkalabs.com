<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Building a Scalable Ingestion Pipeline with Rust · Tarka Labs - Tarka Labs</title><meta name="gridsome:hash" content="4e835d287785e482d873833e927668661a23737e"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="viewport" content="width=device-width, initial-scale=1.0"><meta data-vue-tag="ssr" property="og:title" content="Building a Scalable Ingestion Pipeline with Rust · Tarka Labs"><meta data-vue-tag="ssr" property="og:description" content="Large industrial pipelines running down a steep, grassy hillside toward a river below"><meta data-vue-tag="ssr" property="og:image" content="/assets/img/pipeline-cover.4796ea68.webp"><meta data-vue-tag="ssr" property="og:image:height" content="627"><meta data-vue-tag="ssr" property="og:image:width" content="1200"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.92f6d0f06feb6aec5e019521ff224fd8.png"><link rel="preload" href="/assets/css/0.styles.caf054be.css" as="style"><link rel="preload" href="/assets/js/app.5549cb77.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--blog-vue.18adb478.js" as="script"><link rel="stylesheet" href="/assets/css/0.styles.caf054be.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
    <meta
      name="google-site-verification"
      content="j7cLUK-kxGEpMOY7valSkamH4kQe_l38yMMAXbpk19U"
    />
    <noscript>
      <div class="noscript-container">
        <a href="/" class="noscript-logo">Tarka <br />_Labs</a>
        <div class="noscript-text-container">
          <h1>Uh oh! Looks like <span>JavaScript</span> is disabled.</h1>
          <p>
            Bitman requires <span>JavaScript</span> to fuel his thirst to end
            bad UX and lazy design, which is necessary to give you the best
            viewing experience possible. Please enable it to continue to our
            website.
          </p>
        </div>
      </div>
    </noscript>
  </head>

  <body >
    <div><div id="app" data-server-rendered="true" data-v-71a2ecff><div data-v-71a2ecff><div id="banner-section" data-v-71a2ecff><div class="banner" style="background:;display:none;" data-v-71a2ecff><div class="layout" data-v-71a2ecff><div data-v-71a2ecff></div><div class="hero heading-size-5" style="color:#ffffff;" data-v-71a2ecff></div><div data-v-71a2ecff></div></div></div><div data-v-71a2ecff></div></div><div class="sidebar" data-v-d6d2017e data-v-71a2ecff><div class="nav" data-v-d6d2017e><div class="fixed" data-v-d6d2017e><a href="/" data-v-9b1a4c9c data-v-d6d2017e> TARKA<br data-v-9b1a4c9c>_LABS </a><div class="menu" data-v-50705736 data-v-d6d2017e><div class="control" style="stroke:black;" data-v-50705736><div class="spinner heading-size-9" data-v-02ea7230 data-v-50705736><span class="side-menu-symbol" data-v-02ea7230><span class="menu-symbol rotate180t90" data-v-02ea7230><svg height="10" width="10" data-v-02ea7230><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-02ea7230></line></svg></span><span class="menu-symbol rotate90t0" data-v-02ea7230><svg height="10" width="10" data-v-02ea7230><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-02ea7230></line></svg></span></span><span style="vertical-align: middle" data-v-02ea7230> menu </span></div><div class="active-page body-jetbrains-size-11 fade-in" data-v-128e5feb data-v-50705736>
  
</div></div><div class="items hidden" data-v-50705736><ul class="main-nav" data-v-1c6945ef data-v-50705736><div class="primary fadeOut sidebar" data-v-1c6945ef><li data-v-1c6945ef><a href="/music-tech" data-v-1c6945ef>/MusicTech</a></li><li data-v-1c6945ef><a href="/health-care-tech" data-v-1c6945ef>/HealthCareTech</a></li><li data-v-1c6945ef><a href="/genai" data-v-1c6945ef>/GenAI</a></li><li data-v-1c6945ef><a href="https://solutions.tarkalabs.com/design/" target="_self" data-v-1c6945ef>/Design</a></li><li data-v-1c6945ef><a href="/develop" data-v-1c6945ef>/Develop</a></li><li data-v-1c6945ef><a href="/case-studies" data-v-1c6945ef>
        /Case_Studies
      </a></li><li data-v-1c6945ef><a href="/careers" data-v-1c6945ef>/Careers</a></li><li data-v-1c6945ef><a href="/about" data-v-1c6945ef>/About</a></li><li data-v-1c6945ef><a href="/contact" data-v-1c6945ef>/Contact</a></li></div></ul><ul class="sub body-jetbrains-size-11 fadeOut sidebar" data-v-3cc3824e data-v-50705736><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul></div></div><a href="/contact" class="heading-size-9" data-v-573e12d8 data-v-d6d2017e>
  Get in<br data-v-573e12d8>touch<span class="arrow" data-v-573e12d8>-&gt;</span></a></div></div><!----></div><div class="baseLayout" data-v-996dafb6 data-v-71a2ecff><div data-v-996dafb6></div><div data-v-996dafb6><div class="blog-details-page" data-v-996dafb6><div class="inner-section" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>
        /web - 5 min read
      </p><h1 class="title" data-v-996dafb6>Building a Scalable Ingestion Pipeline with Rust</h1><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/dhruva.ddea2a05.jpg" alt="Dhruva Sagar" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Dhruva Sagar</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div></div><img src="/assets/img/pipeline-cover.4796ea68.webp" alt="" class="header-img" data-v-996dafb6><div class="toc-wrapper" data-v-996dafb6><h2 class="heading-size-7" data-v-996dafb6>Table of contents</h2><div class="toc" data-v-996dafb6><a href="#content" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/01</p><p data-v-996dafb6>Intro</p></a><a href="#toc-section-1" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/02</p><p data-v-996dafb6>Overview of the Ingestion Pipeline</p></a><a href="#toc-section-2" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/03</p><p data-v-996dafb6>Key Design Patterns and Architectural Choices</p></a><a href="#toc-section-3" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/04</p><p data-v-996dafb6>Message Queuing with AWS SQS</p></a><a href="#toc-section-4" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/05</p><p data-v-996dafb6>Modular Architecture for Enhanced Maintainability</p></a><a href="#toc-section-5" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/06</p><p data-v-996dafb6>Task Trait for Abstraction and Flexibility</p></a><a href="#toc-section-6" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/07</p><p data-v-996dafb6>Robust Error Handling with Color Eyre</p></a><a href="#toc-section-7" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/08</p><p data-v-996dafb6>Efficient Lazy Initialization with Lazy Static</p></a><a href="#toc-section-8" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/09</p><p data-v-996dafb6>Structured Logging and Monitoring</p></a><a href="#toc-section-9" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/10</p><p data-v-996dafb6>Scalability Considerations</p></a><a href="#toc-section-10" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/11</p><p data-v-996dafb6>Conclusion: A Robust and Scalable Solution</p></a></div></div><div id="content" class="content" data-v-996dafb6><p>In today’s fast-paced software development landscape, creating systems that are both scalable and maintainable is crucial. This blog post takes you through an ingestion pipeline built with Rust, showcasing the design patterns and architectural choices that make it robust and efficient.</p>
<h1 id="toc-section-1"><a href="#overview-of-the-ingestion-pipeline" aria-hidden="true"><span class="icon icon-link"></span></a>Overview of the Ingestion Pipeline</h1>
<p>The ingestion pipeline is designed to handle audio files efficiently. It processes these files, generates waveforms, and analyzes tracks using a combination of AWS services, such as SQS (Simple Queue Service) and S3 (Simple Storage Service). The architecture of this pipeline allows it to manage multiple tasks at the same time, ensuring that audio files are processed quickly while keeping the system organized and easy to maintain.</p>
<h1 id="toc-section-2"><a href="#key-design-patterns-and-architectural-choices" aria-hidden="true"><span class="icon icon-link"></span></a>Key Design Patterns and Architectural Choices</h1>
<h2 id="asynchronous-programming-with-tokio"><a href="#asynchronous-programming-with-tokio" aria-hidden="true"><span class="icon icon-link"></span></a>Asynchronous Programming with Tokio</h2>
<p>One of the standout features of this pipeline is its use of the Tokio runtime for asynchronous programming. This approach allows the system to perform non-blocking I/O operations, which is essential when dealing with numerous audio file uploads and processing tasks simultaneously.</p>
<p>By using <code class="language-inline-text">async/await</code>, the code remains clean and easy to read, making it straightforward to follow the flow of data through the pipeline. This means that while one task is waiting for a file to upload, other tasks can continue running, which significantly improves performance.</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">color_eyre<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>sync<span class="token punctuation">::</span></span><span class="token class-name">Arc</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[tokio::main]</span>
<span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> sqs <span class="token operator">=</span> <span class="token class-name">Arc</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token constant">SQS</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token keyword">mut</span> handles <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> ingestion_handle <span class="token operator">=</span> <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span> <span class="token namespace">operations<span class="token punctuation">::</span>ingestion<span class="token punctuation">::</span></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sqs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> track_analysis_handle <span class="token operator">=</span> <span class="token namespace">tokio<span class="token punctuation">::</span></span><span class="token function">spawn</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token keyword">move</span> <span class="token punctuation">{</span> <span class="token namespace">operations<span class="token punctuation">::</span>track_analysis<span class="token punctuation">::</span></span><span class="token function">run</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sqs<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    handles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>ingestion_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    handles<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>track_analysis_handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">tokio<span class="token punctuation">::</span>signal<span class="token punctuation">::</span></span><span class="token function">ctrl_c</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> handle <span class="token keyword">in</span> handles <span class="token punctuation">{</span>
        handle<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="toc-section-3"><a href="#message-queuing-with-aws-sqs" aria-hidden="true"><span class="icon icon-link"></span></a>Message Queuing with AWS SQS</h1>
<p>The pipeline leverages AWS SQS for message queuing, which decouples the various components of the system. Each stage of the pipeline can operate independently, processing messages as they arrive. This design choice greatly enhances scalability; if the load increases, you can easily add more consumers to handle the extra messages without needing to change the existing code.</p>
<p>Here is the pattern we implemented for the SQS client that allows us to easily publish or subscribe to SQS queues in an asynchronous way from within the pipelines.</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">aws_sdk_sqs<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token namespace">de<span class="token punctuation">::</span></span><span class="token class-name">DeserializeOwned</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">SQS</span> <span class="token punctuation">{</span>
    client<span class="token punctuation">:</span> <span class="token class-name">Client</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[derive(Debug, Serialize)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Message</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Serialize</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> body<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">impl</span> <span class="token constant">SQS</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token keyword">Self</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> aws_config <span class="token operator">=</span> <span class="token namespace">aws<span class="token punctuation">::</span></span><span class="token function">load_from_env</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> client <span class="token operator">=</span> <span class="token class-name">Client</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>aws_config<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">Self</span> <span class="token punctuation">{</span> client <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">publish</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> queue<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">String</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Message</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span>
    <span class="token keyword">where</span>
        <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Serialize</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>client
            <span class="token punctuation">.</span><span class="token function">send_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">queue_url</span><span class="token punctuation">(</span>queu<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">message_body</span><span class="token punctuation">(</span><span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>message<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token keyword">await</span>
            <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>e<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
                <span class="token macro property">eyre!</span><span class="token punctuation">(</span>
                    <span class="token string">"Failed to publish message to SQS queue: {:?}, error: {:?}"</span><span class="token punctuation">,</span>
                    queue<span class="token punctuation">,</span>
                    e
                <span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">;</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">subscribe</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token punctuation">,</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">Fut</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">self</span><span class="token punctuation">,</span> queue<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> callback<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span>
    <span class="token keyword">where</span>
        <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">DeserializeOwned</span><span class="token punctuation">,</span>
        <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token constant">SQS</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Fut</span><span class="token punctuation">,</span>
        <span class="token class-name">Fut</span><span class="token punctuation">:</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">>></span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">loop</span> <span class="token punctuation">{</span>
            <span class="token keyword">match</span> <span class="token keyword">self</span>
                <span class="token punctuation">.</span>client
                <span class="token punctuation">.</span><span class="token function">receive_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">wait_time_seconds</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">queue_url</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token keyword">await</span>
            <span class="token punctuation">{</span>
                <span class="token class-name">Ok</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span> message <span class="token keyword">in</span> response<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">unwrap_or_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Received SQS Message: {:?}, from queue: {}"</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">let</span> cloned_message <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">let</span> receipt_handle <span class="token operator">=</span> cloned_message<span class="token punctuation">.</span><span class="token function">receipt_handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span> <span class="token operator">=</span> message<span class="token punctuation">.</span>body <span class="token punctuation">{</span>
                            <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Trying to deserialize body: {:?}"</span><span class="token punctuation">,</span> body<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">match</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                                <span class="token class-name">Ok</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                                    <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
                                        <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span>
                                            <span class="token string">"Callback failed for SQS queue: {}, error: {:?}"</span><span class="token punctuation">,</span>
                                            queue<span class="token punctuation">,</span>
                                            e
                                        <span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token keyword">self</span>
                                            <span class="token punctuation">.</span>client
                                            <span class="token punctuation">.</span><span class="token function">delete_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token function">queue_url</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token function">receipt_handle</span><span class="token punctuation">(</span>receipt_handle<span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                            <span class="token punctuation">.</span><span class="token keyword">await</span>
                                        <span class="token punctuation">{</span>
                                            <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Failed to delete message from queue: {:?}, error: {:?}"</span><span class="token punctuation">,</span> queue<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                                            <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Message deleted from SQS queue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span>
                                    <span class="token punctuation">}</span>
                                <span class="token punctuation">}</span>
                                <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                                    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Error decoding message from SQS queue: {}, error: {:?}"</span><span class="token punctuation">,</span> queue<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                    <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Error receiving messages from AWS SQS: {:?}"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="toc-section-4"><a href="#modular-architecture-for-enhanced-maintainability" aria-hidden="true"><span class="icon icon-link"></span></a>Modular Architecture for Enhanced Maintainability</h1>
<p>The codebase is organized into distinct modules, each responsible for a specific functionality, such as <code class="language-inline-text">aws</code>, <code class="language-inline-text">backend</code>, <code class="language-inline-text">tasks</code>, and <code class="language-inline-text">operations</code>. This modular design promotes separation of concerns, making the code easier to maintain and extend.</p>
<p>Each module encapsulates its logic, allowing for independent testing and development. For example, the <code class="language-inline-text">tasks</code> module contains the <code class="language-inline-text">Transcoder</code> and <code class="language-inline-text">WaveformGenerator</code>, which handle specific tasks in the pipeline. This organization not only makes the code cleaner but also allows developers to work on different parts of the system without stepping on each other's toes.</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">mod</span> <span class="token module-declaration namespace">tasks</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">transcoder</span><span class="token punctuation">;</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">waveform_generator</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="toc-section-5"><a href="#task-trait-for-abstraction-and-flexibility" aria-hidden="true"><span class="icon icon-link"></span></a>Task Trait for Abstraction and Flexibility</h1>
<p>The <code class="language-inline-text">Task</code> trait defines a common interface for all tasks within the pipeline. This abstraction allows for different implementations of tasks, such as transcoding and waveform generation, to be executed interchangeably.</p>
<p>By using traits, the code adheres to the Open/Closed Principle, which means you can add new tasks without modifying existing code. This flexibility is vital for adapting to new requirements or technologies as they emerge.</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">async_trait<span class="token punctuation">::</span></span>async_trait<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">color_eyre<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Task</span><span class="token punctuation">:</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span> <span class="token punctuation">{</span>
    <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">run</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="toc-section-6"><a href="#robust-error-handling-with-color-eyre" aria-hidden="true"><span class="icon icon-link"></span></a>Robust Error Handling with Color Eyre</h1>
<p>Error handling is a critical aspect of any robust system. The pipeline employs the <code class="language-inline-text">color_eyre</code> crate for error handling, providing rich context for any issues that arise during execution. This enhances observability, making it easier to diagnose problems when they occur.</p>
<p>By consistently using <code class="language-inline-text">Result</code> types throughout the codebase, errors are propagated up the call stack, allowing for centralized error handling and logging. This means that when something goes wrong, you have all the information you need to fix it quickly.</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">color_eyre<span class="token punctuation">::</span></span><span class="token class-name">Result</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">example_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token comment">// Some code that might fail</span>
    <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="toc-section-7"><a href="#efficient-lazy-initialization-with-lazy-static" aria-hidden="true"><span class="icon icon-link"></span></a>Efficient Lazy Initialization with Lazy Static</h1>
<p>The <code class="language-inline-text">lazy_static</code> crate is used to initialize global settings and configurations only when they are first accessed. This approach minimizes startup time and memory usage, as configurations are loaded on demand.</p>
<p>The global <code class="language-inline-text">SETTING</code> instance acts as a centralized configuration management system, making it easy to access application settings throughout the codebase. This ensures that your application runs efficiently without unnecessary overhead.</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token attribute attr-name">#[macro_use]</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">lazy_static</span><span class="token punctuation">;</span>

<span class="token macro property">lazy_static!</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">SETTING</span><span class="token punctuation">:</span> <span class="token class-name">Setting</span> <span class="token operator">=</span> <span class="token class-name">Setting</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="toc-section-8"><a href="#structured-logging-and-monitoring" aria-hidden="true"><span class="icon icon-link"></span></a>Structured Logging and Monitoring</h1>
<p>Finally, the pipeline integrates structured logging using the <code class="language-inline-text">log</code> crate. This provides valuable insights into the system's behavior during execution, which is essential for monitoring the health of the pipeline and diagnosing issues in production.</p>
<p>By logging at various levels (info, error), developers can filter logs based on severity, making it easier to identify critical issues and respond promptly.</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token punctuation">{</span>info<span class="token punctuation">,</span> error<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">example_logging</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"This is an info message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"This is an error message"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="toc-section-9"><a href="#scalability-considerations" aria-hidden="true"><span class="icon icon-link"></span></a>Scalability Considerations</h1>
<p>The design choices made in this ingestion pipeline significantly contribute to its scalability:</p>
<ul>
<li><strong>Horizontal Scalability:</strong> By using SQS, multiple consumers can process messages concurrently, allowing the system to scale horizontally as the load increases. New instances of the application can be spun up to handle additional traffic without requiring changes to the existing codebase.</li>
<li><strong>Decoupled Components:</strong> Each component of the pipeline operates independently, making it easy to update and modify. For instance, if a new audio processing algorithm is introduced, it can be added as a new task without affecting the existing pipeline.</li>
<li><strong>Efficient Resource Utilization:</strong> The asynchronous nature of the pipeline ensures that resources are utilized efficiently. While one task is waiting for I/O operations (like downloading files from S3), other tasks can continue processing, maximizing throughput.</li>
</ul>
<h1 id="toc-section-10"><a href="#conclusion-a-robust-and-scalable-solution" aria-hidden="true"><span class="icon icon-link"></span></a>Conclusion: A Robust and Scalable Solution</h1>
<p>The ingestion pipeline crafted with Rust exemplifies modern software design principles, emphasizing scalability, maintainability, and robustness. By leveraging asynchronous programming, modular architecture, and effective error handling, the pipeline is well-equipped to meet the demands of processing audio files in a cloud-native environment.</p>
</div><hr data-v-996dafb6><div class="inner-section" data-v-996dafb6><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/dhruva.ddea2a05.jpg" alt="Dhruva Sagar" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Dhruva Sagar</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div><p class="body-opensans-size-9" data-v-996dafb6>He is still thinking what to write about him</p><div class="social-links" data-v-996dafb6><!----><!----><a href="https://medium.com/@dhruvasagar" target="_blank" class="heading-size-9" data-v-996dafb6>
          Medium
        </a></div></div><hr data-v-996dafb6><div class="related-articles" data-v-996dafb6><div class="flex-space-between" data-v-996dafb6><p class="heading-size-7" data-v-996dafb6>_related articles</p><a href="/blogs" class="heading-size-9 underline" data-v-996dafb6>View all</a></div><div class="flex-space-between blog-card-wrapper" data-v-996dafb6><a href="/blogs/inserting-millions-of-records-in-java" class="blog-card" data-v-996dafb6><img src="/assets/img/image-2.d7113a92.webp" alt="Inserting Millions of Records in Java: Strategies and Benchmarks" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Inserting Millions of Records in Java: Strategies and Benchmarks</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Kesavan   11 min read
            </p></div></a><a href="/blogs/scaling-royalty-payout-p2" class="blog-card" data-v-996dafb6><img src="/assets/img/default-cover.55254b66.png" alt="" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Scaling Royalty Payouts in Music Distribution: Challenges and Solutions from the Frontlines (Part 2)</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Harman Sohanpal   5 min read
            </p></div></a></div></div><div class="lets-talk" data-v-188e6a71><div class="message heading-size-7" data-v-188e6a71>
    Let’s build digital solutions together.
  </div><div class="action-container" data-v-188e6a71><div class="action-button heading-size-5" data-v-188e6a71><div data-v-188e6a71>Get in touch</div><div class="arrow" data-v-188e6a71>-&gt;</div></div><img src="/assets/img/talk.71d1d2f3.svg" alt="Lenny Face" data-v-188e6a71></div></div></div></div><div data-v-996dafb6></div></div><div id="footer" class="baseLayout" data-v-996dafb6 data-v-71a2ecff><div data-v-996dafb6></div><div data-v-996dafb6><div class="site-footer" data-v-0a037a4b data-v-71a2ecff><ul class="main-nav footer" data-v-1c6945ef data-v-0a037a4b><div class="primary fadeIn" data-v-1c6945ef><li data-v-1c6945ef><a href="/music-tech" data-v-1c6945ef>/MusicTech</a></li><li data-v-1c6945ef><a href="/health-care-tech" data-v-1c6945ef>/HealthCareTech</a></li><li data-v-1c6945ef><a href="/genai" data-v-1c6945ef>/GenAI</a></li><li data-v-1c6945ef><a href="https://solutions.tarkalabs.com/design/" target="_self" data-v-1c6945ef>/Design</a></li><li data-v-1c6945ef><a href="/develop" data-v-1c6945ef>/Develop</a></li><li data-v-1c6945ef><a href="/case-studies" data-v-1c6945ef>
        /Case_Studies
      </a></li><li data-v-1c6945ef><a href="/careers" data-v-1c6945ef>/Careers</a></li><li data-v-1c6945ef><a href="/about" data-v-1c6945ef>/About</a></li><li data-v-1c6945ef><a href="/contact" data-v-1c6945ef>/Contact</a></li></div></ul><div class="subnav" data-v-0a037a4b><ul class="sub body-jetbrains-size-11 footer fadeIn" data-v-3cc3824e data-v-0a037a4b><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul><div data-v-fae945d8 data-v-0a037a4b><a href="https://twitter.com/tarkalabs" target="_blank" rel="noopener" class="external" data-v-fae945d8>Twitter</a><a href="https://in.linkedin.com/company/tarka-labs" target="_blank" rel="noopener" class="external" data-v-fae945d8>LinkedIn</a></div><div class="sedin" data-v-0a037a4b><a href="https://sedintechnologies.com/" target="_blank" rel="noopener" class="external" data-v-0a037a4b>Tarka Labs is a division of Sedin Technologies</a></div></div></div></div><div data-v-996dafb6></div></div></div></div></div>
    <script src="/assets/js/app.5549cb77.js" defer></script><script src="/assets/js/page--src--templates--blog-vue.18adb478.js" defer></script><script data-vue-tag="ssr" src="https://unpkg.com/@lottiefiles/lottie-player@0.4.0/dist/lottie-player.js" data-body="true"></script>
  </body>
</html>
