<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Tarka Labs - Tarka Labs</title><meta name="gridsome:hash" content="a92d0a7aa26f8cebd9d116562e0db9b5b999676c"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="viewport" content="width=device-width, initial-scale=1.0"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.92f6d0f06feb6aec5e019521ff224fd8.png"><link rel="preload" href="/assets/css/0.styles.22f463e0.css" as="style"><link rel="preload" href="/assets/js/app.df2cb3d4.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--blog-vue.dea0bef5.js" as="script"><link rel="stylesheet" href="/assets/css/0.styles.22f463e0.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
    <noscript>
      <div class="noscript-container">
        <a href="/" class="noscript-logo">Tarka <br />_Labs</a>
        <div class="noscript-text-container">
          <h1>Uh oh! Looks like <span>JavaScript</span> is disabled.</h1>
          <p>
            Bitman requires <span>JavaScript</span> to fuel his thirst to end
            bad UX and lazy design, which is necessary to give you the best
            viewing experience possible. Please enable it to continue to our
            website.
          </p>
        </div>
      </div>
    </noscript>
  </head>

  <body >
    <div><div id="app" data-server-rendered="true" data-v-b5a9baaa><div data-v-b5a9baaa><div id="banner-section" data-v-b5a9baaa><div class="banner" style="background:;display:none;" data-v-b5a9baaa><div class="layout" data-v-b5a9baaa><div data-v-b5a9baaa></div><div class="hero heading-size-5" style="color:#ffffff;" data-v-b5a9baaa></div><div data-v-b5a9baaa></div></div></div><div data-v-b5a9baaa></div></div><div class="sidebar" data-v-d6d2017e data-v-b5a9baaa><div class="nav" data-v-d6d2017e><div class="fixed" data-v-d6d2017e><a href="/" data-v-9b1a4c9c data-v-d6d2017e> TARKA<br data-v-9b1a4c9c>_LABS </a><div class="menu" data-v-50705736 data-v-d6d2017e><div class="control" style="stroke:black;" data-v-50705736><div class="spinner heading-size-9" data-v-48940e1e data-v-50705736><span class="side-menu-symbol" data-v-48940e1e><span class="menu-symbol rotate180t90" data-v-48940e1e><svg height="10" width="10" data-v-48940e1e><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-48940e1e></line></svg></span><span class="menu-symbol rotate90t0" data-v-48940e1e><svg height="10" width="10" data-v-48940e1e><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-48940e1e></line></svg></span></span><span class="Spinner-text" data-v-48940e1e> menu </span></div><div class="active-page body-jetbrains-size-11 fade-in" data-v-4767b8ae data-v-50705736>
  
</div></div><div class="items hidden" data-v-50705736><ul class="main-nav" data-v-20ea19cd data-v-50705736><div class="primary fadeOut sidebar" data-v-20ea19cd><li data-v-20ea19cd><a href="https://design.tarkalabs.com/" target="_self" data-v-20ea19cd>/Design</a></li><li data-v-20ea19cd><a href="/develop" data-v-20ea19cd>/Develop</a></li><li data-v-20ea19cd><a href="/projects" data-v-20ea19cd>/Case_Studies</a></li><li data-v-20ea19cd><a href="/careers" data-v-20ea19cd>/Careers</a></li><li data-v-20ea19cd><a href="/about" data-v-20ea19cd>/About</a></li><li data-v-20ea19cd><a href="/contact" data-v-20ea19cd>/Contact</a></li></div></ul><ul class="sub body-jetbrains-size-11 fadeOut sidebar" data-v-3cc3824e data-v-50705736><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul></div></div><a href="/contact" class="heading-size-9" data-v-573e12d8 data-v-d6d2017e>
  Get in<br data-v-573e12d8>touch<span class="arrow" data-v-573e12d8>-&gt;</span></a></div></div><!----></div><div class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="blog-details-page" data-v-996dafb6><div class="inner-section" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>
        /web - 3 min read
      </p><h1 class="title" data-v-996dafb6>Generic Callbacks in Rust</h1><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/dhruva.ddea2a05.jpg" alt="Dhruva Sagar" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Dhruva Sagar</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div></div><img src="/assets/img/generic-callbacks-rust.5686d2e2.webp" alt="Generic Callbacks in Rust" class="header-img" data-v-996dafb6><!----><div id="content" class="content" data-v-996dafb6><p>In a recent project, we developed an ingestion pipeline in Rust.
We wanted to execute asynchronous tasks in response to messages received from SQS, as a subscriber.
Our goal was to leverage Rust generics to allow the subscriber to take ownership of the payload schema and the pipeline implementation details.
This approach enables the separation of the SQS subscription logic from the subscriber’s responsibilities, promoting of cleaner separation of concerns.
It also facilitates independent testing of both components, ensuring they can be assessed in isolation.</p>
<p>Here’s what we came up with :</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">aws_sdk_sqs<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">DeserializeOwned</span><span class="token punctuation">,</span> <span class="token class-name">Serialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token class-name">Error</span> <span class="token keyword">as</span> <span class="token class-name">JsonError</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">thiserror<span class="token punctuation">::</span></span><span class="token class-name">Error</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug, Error)]</span>
<span class="token keyword">pub</span> <span class="token keyword">enum</span> <span class="token type-definition class-name">QueueError</span> <span class="token punctuation">{</span>
  <span class="token attribute attr-name">#[error(<span class="token string">"Error receiving message from SQS queue: {0}"</span>)]</span>
  <span class="token class-name">ReceiveError</span><span class="token punctuation">(</span><span class="token attribute attr-name">#[from]</span> <span class="token class-name">ReceiveMessageError</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token attribute attr-name">#[error(<span class="token string">"Error deleting message from SQS queue: {0}"</span>)]</span>
  <span class="token class-name">DeleteError</span><span class="token punctuation">(</span><span class="token attribute attr-name">#[from]</span> <span class="token class-name">DeleteMessageError</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token attribute attr-name">#[error(<span class="token string">"Error sending message to SQS queue: {0}"</span>)]</span>
  <span class="token class-name">SendError</span><span class="token punctuation">(</span><span class="token attribute attr-name">#[from]</span> <span class="token class-name">SendMessageError</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token attribute attr-name">#[error(<span class="token string">"Error serializing/deserializing JSON: {0}"</span>)]</span>
  <span class="token class-name">JsonSerializationError</span><span class="token punctuation">(</span><span class="token class-name">JsonError</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token attribute attr-name">#[error(<span class="token string">"Callback failed: {0}"</span>)]</span>
  <span class="token class-name">CallbackError</span><span class="token punctuation">(</span><span class="token attribute attr-name">#[source]</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span><span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">subscribe</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">F</span><span class="token punctuation">,</span> <span class="token class-name">Fut</span><span class="token operator">></span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Client</span><span class="token punctuation">,</span> queue<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> callback<span class="token punctuation">:</span> <span class="token class-name">F</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">QueueError</span><span class="token operator">></span>
<span class="token keyword">where</span>
  <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">DeserializeOwned</span><span class="token punctuation">,</span>
  <span class="token class-name">F</span><span class="token punctuation">:</span> <span class="token class-name">Fn</span><span class="token punctuation">(</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Fut</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span><span class="token punctuation">,</span>
  <span class="token class-name">Fut</span><span class="token punctuation">:</span> <span class="token class-name">Future</span><span class="token operator">&lt;</span><span class="token class-name">Output</span> <span class="token operator">=</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token keyword">dyn</span> <span class="token namespace">std<span class="token punctuation">::</span>error<span class="token punctuation">::</span></span><span class="token class-name">Error</span> <span class="token operator">+</span> <span class="token class-name">Send</span> <span class="token operator">+</span> <span class="token class-name">Sync</span><span class="token operator">>></span><span class="token operator">></span> <span class="token operator">+</span> <span class="token class-name">Send</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  <span class="token keyword">loop</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> client
      <span class="token punctuation">.</span><span class="token function">receive_messages</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">queue_url</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token keyword">await</span>
      <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token keyword">for</span> message <span class="token keyword">in</span> response<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">unwrap_or_default</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Received SQS Message: {:?}, from Queue: {}"</span><span class="token punctuation">,</span> message<span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> cloned_message <span class="token operator">=</span> message<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">let</span> receipt_handle <span class="token operator">=</span> cloned_message<span class="token punctuation">.</span>receipt_handle<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span> <span class="token operator">=</span> message<span class="token punctuation">.</span>body <span class="token punctuation">{</span>
              <span class="token keyword">match</span> <span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">from_str</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Ok</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                  <span class="token keyword">match</span> <span class="token function">callback</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
                    <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Callback completed successfully for SQS queue: {}"</span><span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                      <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Callback failed for SQS Queue: {}, error: {:?}"</span><span class="token punctuation">,</span> queue<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">QueueError</span><span class="token punctuation">::</span><span class="token class-name">CallbackError</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">into</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                  <span class="token punctuation">}</span>

                  <span class="token keyword">match</span> client
                    <span class="token punctuation">.</span><span class="token function">delete_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">queue_url</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">receipt_handle</span><span class="token punctuation">(</span>receipt_handle<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token keyword">await</span>
                    <span class="token punctuation">{</span>
                      <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">info!</span><span class="token punctuation">(</span><span class="token string">"Message deleted from SQS queue: {}"</span><span class="token punctuation">,</span> queue<span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                        <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Failed to delete message from queue: {}, error: {:?}"</span><span class="token punctuation">,</span> queue<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">QueueError</span><span class="token punctuation">::</span><span class="token class-name">DeleteError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
                  <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Error decoding message from SQS queue: {}, error: {:?}"</span><span class="token punctuation">,</span> queue<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">QueueError</span><span class="token punctuation">::</span><span class="token class-name">JsonSerializationError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
          <span class="token namespace">log<span class="token punctuation">::</span></span><span class="token macro property">error!</span><span class="token punctuation">(</span><span class="token string">"Error receive messages from SQS queue: {}, error: {:?}"</span><span class="token punctuation">,</span> queue<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token class-name">QueueError</span><span class="token punctuation">::</span><span class="token class-name">ReceiveError</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The <code class="language-inline-text">subscribe</code> method is generic on 3 things :</p>
<ul>
<li><code class="language-inline-text">T</code> is the payload type that the callback function receives as an argument. <code class="language-inline-text">T</code> should de-serialize from a json string, so should implement <code class="language-inline-text">DeserializeOwned</code></li>
<li><code class="language-inline-text">F</code> is the callback function, it receives the type <code class="language-inline-text">T</code> as an argument and returns a type that implements <code class="language-inline-text">Fut + Send + Sync</code> This is so that it is asynchronous and can be shared across threads.</li>
<li><code class="language-inline-text">Fut</code> implements a <code class="language-inline-text">Future</code> with <code class="language-inline-text">Output</code> being a <code class="language-inline-text">Result&lt;(), Box&lt;dyn std::error::Error + Send + Sync>>> + Send</code></li>
</ul>
<p>A similar approach for the publisher:</p>
<div class="gridsome-highlight" data-language="rust"><pre class="language-rust"><code class="language-rust"><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token class-name">Serialize</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">aws_sdk_sqs<span class="token punctuation">::</span></span><span class="token class-name">Client</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[derive(Debug, Serialize)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">Message</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Serialize</span><span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token keyword">pub</span> body<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">publish</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">(</span>client<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Client</span><span class="token punctuation">,</span> queue<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">Message</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">-></span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">QueueError</span><span class="token operator">></span>
<span class="token keyword">where</span>
  <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Serialize</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
  client
    <span class="token punctuation">.</span><span class="token function">send_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">queue_url</span><span class="token punctuation">(</span>queue<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">message_body</span><span class="token punctuation">(</span><span class="token namespace">serde_json<span class="token punctuation">::</span></span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>message<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token keyword">await</span><span class="token operator">?</span><span class="token punctuation">;</span>
  <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The <code class="language-inline-text">publish</code> function is generic on the type <code class="language-inline-text">T</code>.
It must implement the <code class="language-inline-text">Serialize</code> trait.
It is passed as the <code class="language-inline-text">body</code> field of the <code class="language-inline-text">Message</code> struct argument.
This message body is then serialized to a string when calling the SQS <code class="language-inline-text">send_message</code> API.</p>
</div><hr data-v-996dafb6><div class="inner-section" data-v-996dafb6><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/dhruva.ddea2a05.jpg" alt="Dhruva Sagar" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Dhruva Sagar</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div><p class="body-opensans-size-9" data-v-996dafb6>He is still thinking what to write about him</p><div class="social-links" data-v-996dafb6><!----><!----><a href="https://medium.com/@dhruvasagar" target="_blank" class="heading-size-9" data-v-996dafb6>
          Medium
        </a></div></div><hr data-v-996dafb6><div class="related-articles" data-v-996dafb6><div class="flex-space-between" data-v-996dafb6><p class="heading-size-7" data-v-996dafb6>_related articles</p><a href="/blogs" class="heading-size-9 underline" data-v-996dafb6>View all</a></div><div class="flex-space-between blog-card-wrapper" data-v-996dafb6><a href="/blogs/go-dto-pattern" class="blog-card" data-v-996dafb6><img src="/assets/img/go-dto-pattern.4d5aa661.webp" alt="Leveraging DTO pattern in Go-based web apps" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Leveraging DTO pattern in Go-based web apps</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Shamil Siddique   4 min read
            </p></div></a><a href="/blogs/kafka-message-duplication" class="blog-card" data-v-996dafb6><img src="/assets/img/kafka-message-duplication.30a6cddc.webp" alt="Handling message duplication in Kafka" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Handling message duplication in Kafka</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Vignesh Ravichandran   5 min read
            </p></div></a></div></div><div class="lets-talk" data-v-188e6a71><div class="message heading-size-7" data-v-188e6a71>
    Let’s build digital solutions together.
  </div><div class="action-container" data-v-188e6a71><div class="action-button heading-size-5" data-v-188e6a71><div data-v-188e6a71>Get in touch</div><div class="arrow" data-v-188e6a71>-&gt;</div></div><img src="/assets/img/talk.71d1d2f3.svg" alt="Lenny Face" data-v-188e6a71></div></div></div></div><div data-v-996dafb6></div></div><div id="footer" class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="site-footer" data-v-0a037a4b data-v-b5a9baaa><ul class="main-nav footer" data-v-20ea19cd data-v-0a037a4b><div class="primary fadeIn" data-v-20ea19cd><li data-v-20ea19cd><a href="https://design.tarkalabs.com/" target="_self" data-v-20ea19cd>/Design</a></li><li data-v-20ea19cd><a href="/develop" data-v-20ea19cd>/Develop</a></li><li data-v-20ea19cd><a href="/projects" data-v-20ea19cd>/Case_Studies</a></li><li data-v-20ea19cd><a href="/careers" data-v-20ea19cd>/Careers</a></li><li data-v-20ea19cd><a href="/about" data-v-20ea19cd>/About</a></li><li data-v-20ea19cd><a href="/contact" data-v-20ea19cd>/Contact</a></li></div></ul><div class="subnav" data-v-0a037a4b><ul class="sub body-jetbrains-size-11 footer fadeIn" data-v-3cc3824e data-v-0a037a4b><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul><div data-v-fae945d8 data-v-0a037a4b><a href="https://twitter.com/tarkalabs" target="_blank" rel="noopener" class="external" data-v-fae945d8>Twitter</a><a href="https://in.linkedin.com/company/tarka-labs" target="_blank" rel="noopener" class="external" data-v-fae945d8>LinkedIn</a></div><div class="sedin" data-v-0a037a4b><a href="https://sedintechnologies.com/" target="_blank" rel="noopener" class="external" data-v-0a037a4b>Tarka Labs is a division of Sedin Technologies</a></div></div></div></div><div data-v-996dafb6></div></div></div></div></div>
    <script src="/assets/js/app.df2cb3d4.js" defer></script><script src="/assets/js/page--src--templates--blog-vue.dea0bef5.js" defer></script><script data-vue-tag="ssr" src="https://unpkg.com/@lottiefiles/lottie-player@0.4.0/dist/lottie-player.js" data-body="true"></script>
  </body>
</html>
