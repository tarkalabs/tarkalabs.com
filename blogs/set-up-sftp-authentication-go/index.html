<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>How to setup SFTP in Golang Authentication Using Go · Tarka Labs - Tarka Labs</title><meta name="gridsome:hash" content="1ce8472a455abf88af7afb52880617df980382b4"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="viewport" content="width=device-width, initial-scale=1.0"><meta data-vue-tag="ssr" property="og:title" content="How to setup SFTP in Golang Authentication Using Go · Tarka Labs"><meta data-vue-tag="ssr" property="og:description" content="How to setup SFTP in Golang Authentication Using Go"><meta data-vue-tag="ssr" property="og:image" content="/assets/img/default-cover.55254b66.png"><meta data-vue-tag="ssr" property="og:image:height" content="627"><meta data-vue-tag="ssr" property="og:image:width" content="1200"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.92f6d0f06feb6aec5e019521ff224fd8.png"><link rel="preload" href="/assets/css/0.styles.b80ae768.css" as="style"><link rel="preload" href="/assets/js/app.31f69850.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--blog-vue.34b6027a.js" as="script"><link rel="stylesheet" href="/assets/css/0.styles.b80ae768.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
    <meta
      name="google-site-verification"
      content="j7cLUK-kxGEpMOY7valSkamH4kQe_l38yMMAXbpk19U"
    />
    <noscript>
      <div class="noscript-container">
        <a href="/" class="noscript-logo">Tarka <br />_Labs</a>
        <div class="noscript-text-container">
          <h1>Uh oh! Looks like <span>JavaScript</span> is disabled.</h1>
          <p>
            Bitman requires <span>JavaScript</span> to fuel his thirst to end
            bad UX and lazy design, which is necessary to give you the best
            viewing experience possible. Please enable it to continue to our
            website.
          </p>
        </div>
      </div>
    </noscript>
  </head>

  <body >
    <div><div id="app" data-server-rendered="true" data-v-b5a9baaa><div data-v-b5a9baaa><div id="banner-section" data-v-b5a9baaa><div class="banner" style="background:;display:none;" data-v-b5a9baaa><div class="layout" data-v-b5a9baaa><div data-v-b5a9baaa></div><div class="hero heading-size-5" style="color:#ffffff;" data-v-b5a9baaa></div><div data-v-b5a9baaa></div></div></div><div data-v-b5a9baaa></div></div><div class="sidebar" data-v-d6d2017e data-v-b5a9baaa><div class="nav" data-v-d6d2017e><div class="fixed" data-v-d6d2017e><a href="/" data-v-9b1a4c9c data-v-d6d2017e> TARKA<br data-v-9b1a4c9c>_LABS </a><div class="menu" data-v-50705736 data-v-d6d2017e><div class="control" style="stroke:black;" data-v-50705736><div class="spinner heading-size-9" data-v-02ea7230 data-v-50705736><span class="side-menu-symbol" data-v-02ea7230><span class="menu-symbol rotate180t90" data-v-02ea7230><svg height="10" width="10" data-v-02ea7230><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-02ea7230></line></svg></span><span class="menu-symbol rotate90t0" data-v-02ea7230><svg height="10" width="10" data-v-02ea7230><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-02ea7230></line></svg></span></span><span style="vertical-align: middle" data-v-02ea7230> menu </span></div><div class="active-page body-jetbrains-size-11 fade-in" data-v-4767b8ae data-v-50705736>
  
</div></div><div class="items hidden" data-v-50705736><ul class="main-nav" data-v-6a43ac6d data-v-50705736><div class="primary fadeOut sidebar" data-v-6a43ac6d><li data-v-6a43ac6d><a href="/genai" data-v-6a43ac6d>/GenAI</a></li><li data-v-6a43ac6d><a href="https://design.tarkalabs.com/" target="_self" data-v-6a43ac6d>/Design</a></li><li data-v-6a43ac6d><a href="/develop" data-v-6a43ac6d>/Develop</a></li><li data-v-6a43ac6d><a href="/projects" data-v-6a43ac6d>/Case_Studies</a></li><li data-v-6a43ac6d><a href="/careers" data-v-6a43ac6d>/Careers</a></li><li data-v-6a43ac6d><a href="/about" data-v-6a43ac6d>/About</a></li><li data-v-6a43ac6d><a href="/contact" data-v-6a43ac6d>/Contact</a></li></div></ul><ul class="sub body-jetbrains-size-11 fadeOut sidebar" data-v-3cc3824e data-v-50705736><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul></div></div><a href="/contact" class="heading-size-9" data-v-573e12d8 data-v-d6d2017e>
  Get in<br data-v-573e12d8>touch<span class="arrow" data-v-573e12d8>-&gt;</span></a></div></div><!----></div><div class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="blog-details-page" data-v-996dafb6><div class="inner-section" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>
        /web - 2 min read
      </p><h1 class="title" data-v-996dafb6>How to setup SFTP in Golang Authentication Using Go</h1><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/harman.9bd8c31a.jpg" alt="Harman Sohanpal" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Harman Sohanpal</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div></div><img src="/assets/img/default-cover.55254b66.png" alt="How to setup SFTP in Golang Authentication Using Go" class="header-img" data-v-996dafb6><div class="toc-wrapper" data-v-996dafb6><h2 class="heading-size-7" data-v-996dafb6>Table of contents</h2><div class="toc" data-v-996dafb6><a href="#content" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/01</p><p data-v-996dafb6>Intro</p></a><a href="#toc-section-1" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/02</p><p data-v-996dafb6>Method</p></a><a href="#toc-section-2" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/03</p><p data-v-996dafb6>Install SSH Go Library</p></a><a href="#toc-section-3" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/04</p><p data-v-996dafb6>Password Authentication</p></a><a href="#toc-section-4" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/05</p><p data-v-996dafb6>Keyfile Authentication</p></a><a href="#toc-section-5" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/06</p><p data-v-996dafb6>Keyboard Interactive Authentication</p></a><a href="#toc-section-6" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/07</p><p data-v-996dafb6>Combining all methods</p></a></div></div><div id="content" class="content" data-v-996dafb6><figure><img src="/blog/how-to-setup-sftp-using-go/how-to-set-up-sftp-using-go.gif" alt="Image created by Gaurav Singh"><figcaption>Image created by Gaurav Singh</figcaption></figure>
<p><a href="https://en.wikipedia.org/wiki/SSH_File_Transfer_Protocol" target="_blank" rel="nofollow noopener noreferrer">SSH file transfer protocol</a> (also Secure File Transfer Protocol, or SFTP) is a network protocol that provides file access, file transfer and file management over any reliable data stream.</p>
<p>In one of <a href="http://tarkalabs.com/" target="_blank" rel="nofollow noopener noreferrer">our</a> projects for a digital music aggregation company, we had to connect to multiple FTP/SFTP servers to upload music files to digital stores worldwide. Each store used a different authentication mechanism. In this article, we will take a look at different SFTP auth mechanisms and connect to them using Go.</p>
<h1 id="toc-section-1"><a href="#method" aria-hidden="true"><span class="icon icon-link"></span></a>Method</h1>
<ul>
<li>Install SSH Go Library</li>
<li>Connect to SFTP via on of the below methods</li>
</ul>
<ol>
<li>Password Authentication</li>
<li>Keyfile Authentication</li>
<li>Keyboard Interactive Authentication</li>
<li>All in one</li>
</ol>
<h1 id="toc-section-2"><a href="#install-ssh-go-library" aria-hidden="true"><span class="icon icon-link"></span></a>Install SSH Go Library</h1>
<p>As a first step, we need to install <code class="language-inline-text">golang.org/x/crypto/ssh</code> library. We can install it manually using :</p>
<p><code class="language-inline-text">go get golang.org/x/crypto/ssh</code></p>
<h1 id="toc-section-3"><a href="#password-authentication" aria-hidden="true"><span class="icon icon-link"></span></a>Password Authentication</h1>
<p>Once the library is installed we are ready to authenticate using first possible method i.e. Password Authentication. Here’s the snippet for Password authentication for SFTP. Save this file as <code class="language-inline-text">main.go</code></p>
<div class="gridsome-highlight" data-language="golang"><pre class="language-golang"><code class="language-golang">package main
import (
  &quot;fmt&quot;
  &quot;golang.org/x/crypto/ssh&quot;
)
func main() {
  port := 22
  hostname := &quot;hostname&quot;
  password := &quot;password&quot;
  user := &quot;user&quot;
  addr := fmt.Sprintf(&quot;%s:%d&quot;, hostname, port)
  config := ssh.ClientConfig{
    User: user,
    HostKeyCallback: ssh.InsecureIgnoreHostKey(),
    Auth: []ssh.AuthMethod{
      ssh.Password(password),
    },
  }
  conn, err := ssh.Dial(&quot;tcp&quot;, addr, &amp;config)
  if err != nil {
    fmt.Println(&quot;Failed to connect to [%s]: %v&quot;, addr, err)
    return
  }
  defer conn.Close()</code></pre></div>
<h1 id="toc-section-4"><a href="#keyfile-authentication" aria-hidden="true"><span class="icon icon-link"></span></a>Keyfile Authentication</h1>
<p>Another widely used authentication method is Keyfile based authentication. Below is the code snippet for the same.</p>
<div class="gridsome-highlight" data-language="golang"><pre class="language-golang"><code class="language-golang">package main
import (
  &quot;fmt&quot;
  &quot;io/ioutil&quot;
  &quot;golang.org/x/crypto/ssh&quot;
)
func main() {
  port := 22
  hostname := &quot;hostname&quot;
  keypath := &quot;keypath&quot;
  user := &quot;user&quot;
  addr := fmt.Sprintf(&quot;%s:%d&quot;, hostname, port)
  authMethod, _ := readPublicKey(keypath)
  config := ssh.ClientConfig{
    User: user,
    HostKeyCallback: ssh.InsecureIgnoreHostKey(),
    Auth: authMethod,
  }
  conn, err := ssh.Dial(&quot;tcp&quot;, addr, &amp;config)
  if err != nil {
    fmt.Println(&quot;Failed to connect to [%s]: %v&quot;, addr, err)
    return
  }
  defer conn.Close()
}
func readPublicKey(keypath string) ([]ssh.AuthMethod, error){
  pKeyBytes, err := ioutil.ReadFile(keypath)
  if err != nil {
    return nil, err
  }
  signer, err := ssh.ParsePrivateKey(pKeyBytes)
  if err != nil {
    return nil, err
  }
  return []ssh.AuthMethod{
    ssh.PublicKeys(signer),
  }, nil
}</code></pre></div>
<h1 id="toc-section-5"><a href="#keyboard-interactive-authentication" aria-hidden="true"><span class="icon icon-link"></span></a>Keyboard Interactive Authentication</h1>
<p>Almost all the SFTP servers we encountered used the above two auth mechanisms however we were not able to connect to two of our servers. They supported new authentication method Keyboard-Interactive (KBI). <strong>KBI authentication is the most recent form of authentication for SSH</strong>. It involves the server sending prompts to the client, to which the client must respond to correctly to be authenticated.</p>
<p>The code snippet for <code class="language-inline-text">authMethod</code> for KBI authentication is as below.</p>
<div class="gridsome-highlight" data-language="golang"><pre class="language-golang"><code class="language-golang">ssh.KeyboardInteractive(func(user, instruction string, questions []string, echos []bool) ([]string, error) {
  answers := make([]string, len(questions))
  for i, _ := range answers {
    answers[i] = cs.Password
  }
  return answers, nil
}),</code></pre></div>
<h1 id="toc-section-6"><a href="#combining-all-methods" aria-hidden="true"><span class="icon icon-link"></span></a>Combining all methods</h1>
<p>We could not find a way to figure out if a server supported KBI authentication or Password authentication, hence we used the <code class="language-inline-text">array</code>functionality provided by Go SFTP library. It can take in an array of auth methods and try each one until one of them succeeds. The code snippet for the combination of all auth methods is as below.</p>
<div class="gridsome-highlight" data-language="golang"><pre class="language-golang"><code class="language-golang">package main
import (
  &quot;fmt&quot;
  &quot;io/ioutil&quot;
  &quot;golang.org/x/crypto/ssh&quot;
)
func main() {
  port := 22
  hostname := &quot;hostname&quot;
  keypath := &quot;keypath&quot;
  password := &quot;password&quot;
  user := &quot;user&quot;
  addr := fmt.Sprintf(&quot;%s:%d&quot;, hostname, port)
  publicKeyAuth, _ := readPublicKey(keypath)
  config := ssh.ClientConfig{
    User: user,
    HostKeyCallback: ssh.InsecureIgnoreHostKey(),
    Auth: []ssh.AuthMethod{
      publicKeyAuth,
      ssh.Password(password),
      ssh.KeyboardInteractive(func(user, instruction string, questions []string, echos []bool) ([]string, error) {
        answers := make([]string, len(questions))
        for i, _ := range answers {
          answers[i] = password
        }
        return answers, nil
      }),
    },
  }
  conn, err := ssh.Dial(&quot;tcp&quot;, addr, &amp;config)
  if err != nil {
    fmt.Println(&quot;Failed to connect to [%s]: %v&quot;, addr, err)
    return
  }
  defer conn.Close()
}
func readPublicKey(keypath string) (ssh.AuthMethod, error){
  pKeyBytes, err := ioutil.ReadFile(keypath)
  if err != nil {
    return nil, err
  }
  signer, err := ssh.ParsePrivateKey(pKeyBytes)
  if err != nil {
    return nil, err
  }
  return ssh.PublicKeys(signer), nil</code></pre></div>
<p>Finally, we can run this program using <code class="language-inline-text">go run main</code>.</p>
<p>That’s all, folks!</p>
<blockquote>
<p>Hello Montreal! We’ll be at the <a href="https://startupfestival.com/" target="_blank" rel="nofollow noopener noreferrer">Startupfest ’22</a> all three days, so drop by and say hi. We’d love to see what you’re building, and early birds get a free (limited) design audit or tech consultation. DM us on Twitter <a href="https://twitter.com/tarkalabs" target="_blank" rel="nofollow noopener noreferrer">(@tarkalabs)</a> and let’s talk.</p>
</blockquote>
</div><hr data-v-996dafb6><div class="inner-section" data-v-996dafb6><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/harman.9bd8c31a.jpg" alt="Harman Sohanpal" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Harman Sohanpal</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div><p class="body-opensans-size-9" data-v-996dafb6>He is still thinking what to write about him</p><div class="social-links" data-v-996dafb6><!----><!----><!----></div></div><hr data-v-996dafb6><div class="related-articles" data-v-996dafb6><div class="flex-space-between" data-v-996dafb6><p class="heading-size-7" data-v-996dafb6>_related articles</p><a href="/blogs" class="heading-size-9 underline" data-v-996dafb6>View all</a></div><div class="flex-space-between blog-card-wrapper" data-v-996dafb6><a href="/blogs/smart-contracts-store-information" class="blog-card" data-v-996dafb6><img src="/assets/img/default-cover.55254b66.png" alt="Blockchain FTW" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Blockchain as public ledger</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Rahul Nitin Padalkar   5 min read
            </p></div></a><a href="/blogs/using-tarka-chat-in-your-react-vue-apps" class="blog-card" data-v-996dafb6><img src="/assets/img/Photo-by-Volodymyr-Hryshchenko-on-Unsplash.97698903.webp" alt="Using Tarka Chat in your React/Vue apps" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Using Tarka Chat in your React/Vue apps</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Shamil Siddique   5 min read
            </p></div></a></div></div><div class="lets-talk" data-v-188e6a71><div class="message heading-size-7" data-v-188e6a71>
    Let’s build digital solutions together.
  </div><div class="action-container" data-v-188e6a71><div class="action-button heading-size-5" data-v-188e6a71><div data-v-188e6a71>Get in touch</div><div class="arrow" data-v-188e6a71>-&gt;</div></div><img src="/assets/img/talk.71d1d2f3.svg" alt="Lenny Face" data-v-188e6a71></div></div></div></div><div data-v-996dafb6></div></div><div id="footer" class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="site-footer" data-v-0a037a4b data-v-b5a9baaa><ul class="main-nav footer" data-v-6a43ac6d data-v-0a037a4b><div class="primary fadeIn" data-v-6a43ac6d><li data-v-6a43ac6d><a href="/genai" data-v-6a43ac6d>/GenAI</a></li><li data-v-6a43ac6d><a href="https://design.tarkalabs.com/" target="_self" data-v-6a43ac6d>/Design</a></li><li data-v-6a43ac6d><a href="/develop" data-v-6a43ac6d>/Develop</a></li><li data-v-6a43ac6d><a href="/projects" data-v-6a43ac6d>/Case_Studies</a></li><li data-v-6a43ac6d><a href="/careers" data-v-6a43ac6d>/Careers</a></li><li data-v-6a43ac6d><a href="/about" data-v-6a43ac6d>/About</a></li><li data-v-6a43ac6d><a href="/contact" data-v-6a43ac6d>/Contact</a></li></div></ul><div class="subnav" data-v-0a037a4b><ul class="sub body-jetbrains-size-11 footer fadeIn" data-v-3cc3824e data-v-0a037a4b><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul><div data-v-fae945d8 data-v-0a037a4b><a href="https://twitter.com/tarkalabs" target="_blank" rel="noopener" class="external" data-v-fae945d8>Twitter</a><a href="https://in.linkedin.com/company/tarka-labs" target="_blank" rel="noopener" class="external" data-v-fae945d8>LinkedIn</a></div><div class="sedin" data-v-0a037a4b><a href="https://sedintechnologies.com/" target="_blank" rel="noopener" class="external" data-v-0a037a4b>Tarka Labs is a division of Sedin Technologies</a></div></div></div></div><div data-v-996dafb6></div></div></div></div></div>
    <script src="/assets/js/app.31f69850.js" defer></script><script src="/assets/js/page--src--templates--blog-vue.34b6027a.js" defer></script><script data-vue-tag="ssr" src="https://unpkg.com/@lottiefiles/lottie-player@0.4.0/dist/lottie-player.js" data-body="true"></script>
  </body>
</html>
