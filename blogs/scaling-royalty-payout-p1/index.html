<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Scaling Royalty Payouts in Music Distribution: Challenges and Solutions from the Frontlines (Part 1) · Tarka Labs - Tarka Labs</title><meta name="gridsome:hash" content="befc11b432811bca2258a5ed9ac12568bf4c1023"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="viewport" content="width=device-width, initial-scale=1.0"><meta data-vue-tag="ssr" property="og:title" content="Scaling Royalty Payouts in Music Distribution: Challenges and Solutions from the Frontlines (Part 1) · Tarka Labs"><meta data-vue-tag="ssr" property="og:description" content="Scaling Royalty Payouts in Music Distribution: Challenges and Solutions from the Frontlines (Part 1)"><meta data-vue-tag="ssr" property="og:image" content="/assets/img/default-cover.55254b66.png"><meta data-vue-tag="ssr" property="og:image:height" content="627"><meta data-vue-tag="ssr" property="og:image:width" content="1200"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.92f6d0f06feb6aec5e019521ff224fd8.png"><link rel="preload" href="/assets/css/0.styles.2c02ec4b.css" as="style"><link rel="preload" href="/assets/js/app.0797a3da.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--blog-vue.80bca3bd.js" as="script"><link rel="stylesheet" href="/assets/css/0.styles.2c02ec4b.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
    <meta
      name="google-site-verification"
      content="j7cLUK-kxGEpMOY7valSkamH4kQe_l38yMMAXbpk19U"
    />
    <noscript>
      <div class="noscript-container">
        <a href="/" class="noscript-logo">Tarka <br />_Labs</a>
        <div class="noscript-text-container">
          <h1>Uh oh! Looks like <span>JavaScript</span> is disabled.</h1>
          <p>
            Bitman requires <span>JavaScript</span> to fuel his thirst to end
            bad UX and lazy design, which is necessary to give you the best
            viewing experience possible. Please enable it to continue to our
            website.
          </p>
        </div>
      </div>
    </noscript>
  </head>

  <body >
    <div><div id="app" data-server-rendered="true" data-v-b5a9baaa><div data-v-b5a9baaa><div id="banner-section" data-v-b5a9baaa><div class="banner" style="background:;display:none;" data-v-b5a9baaa><div class="layout" data-v-b5a9baaa><div data-v-b5a9baaa></div><div class="hero heading-size-5" style="color:#ffffff;" data-v-b5a9baaa></div><div data-v-b5a9baaa></div></div></div><div data-v-b5a9baaa></div></div><div class="sidebar" data-v-d6d2017e data-v-b5a9baaa><div class="nav" data-v-d6d2017e><div class="fixed" data-v-d6d2017e><a href="/" data-v-9b1a4c9c data-v-d6d2017e> TARKA<br data-v-9b1a4c9c>_LABS </a><div class="menu" data-v-50705736 data-v-d6d2017e><div class="control" style="stroke:black;" data-v-50705736><div class="spinner heading-size-9" data-v-02ea7230 data-v-50705736><span class="side-menu-symbol" data-v-02ea7230><span class="menu-symbol rotate180t90" data-v-02ea7230><svg height="10" width="10" data-v-02ea7230><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-02ea7230></line></svg></span><span class="menu-symbol rotate90t0" data-v-02ea7230><svg height="10" width="10" data-v-02ea7230><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-02ea7230></line></svg></span></span><span style="vertical-align: middle" data-v-02ea7230> menu </span></div><div class="active-page body-jetbrains-size-11 fade-in" data-v-128e5feb data-v-50705736>
  
</div></div><div class="items hidden" data-v-50705736><ul class="main-nav" data-v-244aa462 data-v-50705736><div class="primary fadeOut sidebar" data-v-244aa462><li data-v-244aa462><a href="/music-biz" data-v-244aa462>/MusicBiz</a></li><li data-v-244aa462><a href="/genai" data-v-244aa462>/GenAI</a></li><li data-v-244aa462><a href="https://solutions.tarkalabs.com/design/" target="_self" data-v-244aa462>/Design</a></li><li data-v-244aa462><a href="/develop" data-v-244aa462>/Develop</a></li><li data-v-244aa462><a href="/case-studies" data-v-244aa462>
        /Case_Studies
      </a></li><li data-v-244aa462><a href="/careers" data-v-244aa462>/Careers</a></li><li data-v-244aa462><a href="/about" data-v-244aa462>/About</a></li><li data-v-244aa462><a href="/contact" data-v-244aa462>/Contact</a></li></div></ul><ul class="sub body-jetbrains-size-11 fadeOut sidebar" data-v-3cc3824e data-v-50705736><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul></div></div><a href="/contact" class="heading-size-9" data-v-573e12d8 data-v-d6d2017e>
  Get in<br data-v-573e12d8>touch<span class="arrow" data-v-573e12d8>-&gt;</span></a></div></div><!----></div><div class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="blog-details-page" data-v-996dafb6><div class="inner-section" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>
        /web - 6 min read
      </p><h1 class="title" data-v-996dafb6>Scaling Royalty Payouts in Music Distribution: Challenges and Solutions from the Frontlines (Part 1)</h1><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/harman.9bd8c31a.jpg" alt="Harman Sohanpal" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Harman Sohanpal</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div></div><img src="/assets/img/default-cover.55254b66.png" alt="" class="header-img" data-v-996dafb6><!----><div id="content" class="content" data-v-996dafb6><h2 id="introduction"><a href="#introduction" aria-hidden="true"><span class="icon icon-link"></span></a>Introduction</h2>
<p>At Tarka Labs, we’ve had the privilege of working closely with a diverse range of music clients. From fast scaling distribution platforms to emerging startups. Music distribution involves releasing songs and albums across major DSPs (Digital Service Providers) globally. Once the music goes live, users stream it across different regions, and artists and rights holders are eager to see streaming metrics like listener demographics, location, and engagement trends.</p>
<p>At Tarka Labs, we’ve had the privilege of working closely with a diverse range of music clients. From fast scaling distribution platforms to emerging startups. Music distribution involves releasing songs and albums across major DSPs (Digital Service Providers) globally. Once the music goes live, users stream it across different regions, and artists and rights holders are eager to see streaming metrics like listener demographics, location, and engagement trends.</p>
<h2 id="what-really-happens-behind-the-scenes-in-royalty-payouts"><a href="#what-really-happens-behind-the-scenes-in-royalty-payouts" aria-hidden="true"><span class="icon icon-link"></span></a>What Really Happens Behind the Scenes in Royalty Payouts</h2>
<p>Let’s see what goes under the hood in royalty payouts. The goal here is simple, making sure the royalties that DSPs pay reach the users in a timely manner. But once you get into the details, it gets a lot more complicated.</p>
<p>An artist might want to split their royalties with collaborators. They might have taken an advance from the distributor that needs to be recovered first. Earnings could have tax components to be deducted. There could be charges for promotions like Spotify Discovery Mode or manual adjustments (both positive and negative) that impact what the user should finally get.</p>
<p>And that’s not all. DSPs usually send massive CSV files containing data like UPCs and ISRCs, and these need to be correctly mapped back to the right users. On top of that, there is added complexity due to different currencies, as DSPs, users, and distributor bank accounts may each operate in separate currencies, which brings currency exchange rates into play.</p>
<p>We’ll walk through step by step how Tarka Labs approached these challenges, and how we built systems that helped pay out millions of dollars to users quickly, accurately, and at scale.</p>
<h2 id="figuring-out-who-gets-paid--the-hidden-challenge"><a href="#figuring-out-who-gets-paid--the-hidden-challenge" aria-hidden="true"><span class="icon icon-link"></span></a>Figuring Out Who Gets Paid — The Hidden Challenge</h2>
<p>The first step to solving a scaling problem is understanding it deeply. There’s no point in rushing to implement solutions without first identifying the real bottleneck. In our case, after carefully analysing the process, it was clear that database lookups and Ruby’s single-threaded performance were the major culprits.</p>
<p>Since the process could be easily parallelised, <strong>Golang</strong> was the obvious choice to rework the pipeline. Its native support for concurrency made it a perfect fit. However, even with Go, the database still posed a problem. Running millions of individual queries, or even trying large IN queries, wasn’t efficient enough. Loading the entire database into memory wasn’t practical either, the memory requirements were simply too high.</p>
<p>The next logical step? Caching.</p>
<h2 id="why-not-redis"><a href="#why-not-redis" aria-hidden="true"><span class="icon icon-link"></span></a>Why not Redis?</h2>
<p>Naturally, Redis came to mind. We tried it, loading all the songs and albums into a Redis cache, refreshed weekly via a cron job. But Redis quickly showed its limitations for this use case:</p>
<ul>
<li>The cache size ballooned beyond <strong>10 GB</strong>.</li>
<li>Fetching from Redis still involved a network trip, adding unnecessary latency.</li>
<li>Plus, using AWS Elasticache at this scale added significant costs.</li>
</ul>
<p>Clearly, Redis wasn’t the right tool for this particular problem.</p>
<h2 id="pebbledb-as-a-cache"><a href="#pebbledb-as-a-cache" aria-hidden="true"><span class="icon icon-link"></span></a>PebbleDB as a Cache</h2>
<p>We needed something lightweight, fast, and local. A solution that could handle millions of entries without hogging memory or network bandwidth. That’s when we discovered <a href="https://github.com/cockroachdb/pebble"><strong>Pebble</strong></a>, an embedded key-value store inspired by LevelDB and RocksDB, designed for high performance.</p>
<p>Pebble turned out to be the perfect fit:</p>
<ul>
<li>It compressed the data extremely well bringing 10+ GB of data down to <strong>less than 1.5 GB</strong>.</li>
<li>Reads and writes could be easily parallelised.</li>
<li>Being embedded meant there were no network calls, everything happened locally and lightning-fast.</li>
</ul>
<p>By combining PebbleDB as our lightweight datastore with Go’s powerful concurrency model, we were able to process records in parallel at scale, dramatically speeding up the mapping process.</p>
<h2 id="handling-duplicate-isrcs-overcoming-key-value-store-limitations"><a href="#handling-duplicate-isrcs-overcoming-key-value-store-limitations" aria-hidden="true"><span class="icon icon-link"></span></a>Handling Duplicate ISRCs: Overcoming Key-Value Store Limitations</h2>
<p>Even after optimising the lookup process with PebbleDB, one tricky problem remained: <strong>Duplicate ISRCs</strong>.</p>
<p>Both Redis and PebbleDB are simple key-value stores. Our design used UPC and ISRC as keys to retrieve the associated song or album ID. But key-value stores typically allow only a single value per key. PebbleDB, in particular, is optimised for storing raw byte arrays for maximum compression. It doesn’t natively support storing arrays or lists.</p>
<p>To handle cases where the same ISRC pointed to multiple songs (which happens more often than you might think), we customised the insert logic into PebbleDB.</p>
<p>Here’s how we solved it with read-modify-write pattern:</p>
<ul>
<li>Before writing a new record, we first performed a <strong>GET</strong> for the given ISRC.</li>
<li>If a record already existed, we <strong>appended</strong> the new song details to the existing entry.</li>
<li>We then <strong>saved the combined result back</strong> as a serialised array.</li>
</ul>
<p>This manual management allowed us to efficiently handle multiple songs mapped to the same ISRC, while still benefiting from PebbleDB’s fast reads, compression, and parallel access.</p>
<p>Anyone who has worked in the music distribution space would immediately recognise that <strong>duplicate ISRCs are a major headache</strong>. Ideally, an ISRC (International Standard Recording Code) should uniquely identify a recording, but in practice, that’s often not the case.</p>
<p>A few common scenarios where duplicate ISRCs create chaos:</p>
<ul>
<li>When a <strong>single becomes a hit</strong>, artists or labels sometimes <strong>re-release the same recording</strong> under <strong>multiple albums or compilations</strong>, but reuse <strong>the original ISRC</strong>.</li>
<li>Independent artists or smaller labels may <strong>mistakenly assign the same ISRC</strong> across different versions or releases, due to poor catalog management.</li>
<li>Metadata errors during ingestion at DSPs can <strong>accidentally duplicate ISRCs</strong> across unrelated tracks.</li>
</ul>
<p>All of these scenarios create massive challenges when trying to match royalty payments accurately, especially at scale. If duplicates aren’t handled correctly, users may be underpaid, overpaid, or assigned the wrong payouts, resulting in serious trust and operational challenges.</p>
<p>Our PebbleDB customization ensured that even in these messy real-world cases, payouts could still be processed accurately and efficiently.</p>
<h2 id="scaling-the-processing-from-hours-to-minutes"><a href="#scaling-the-processing-from-hours-to-minutes" aria-hidden="true"><span class="icon icon-link"></span></a>Scaling the Processing: From Hours to Minutes</h2>
<p>Since PebbleDB allowed efficient concurrent reads and writes, we further optimised the processing by breaking it down into smaller, manageable batches.</p>
<p>For example, platforms like YouTube were sending us <strong>over 250 million records</strong> every month. To handle this massive load efficiently, we divided the work into <strong>batches of 50,000 records</strong> each and processed them in parallel. We ran this entire setup on a <strong>modest 4-core, 16 GB RAM machine</strong>.</p>
<p>The approach looked like this:</p>
<ul>
<li>Load a batch of 50,000 records.</li>
<li>Parallelise the lookup and matching using Go routines.</li>
<li>For each batch, collect the matched results and append them into a <strong>CSV file</strong>.</li>
</ul>
<p>Why CSV? Because the downstream systems that picked up this data for payout calculations expected a single consolidated CSV input.</p>
<p>The results were dramatic:</p>
<ul>
<li><strong>Processing 250 million records now took just around 50 minutes</strong>.</li>
<li>Earlier, the same processing would take <strong>8 to 10 hours</strong> — and would get even worse as the dataset grew month over month.</li>
<li>This new scalable approach not only made the system significantly faster but also made it much more predictable and resilient to future growth.</li>
</ul>
<p>That’s all for this article. In the next part, we’ll dive into how the downstream system handled reading through the massive CSV file generated by this processing engine and how we optimized that step for even better performance and reliability.</p>
<p>If you’re working on similar large-scale music distribution, royalty processing, or high-volume data handling challenges, feel free to reach out. We’d love to connect and share ideas.</p>
</div><hr data-v-996dafb6><div class="inner-section" data-v-996dafb6><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/harman.9bd8c31a.jpg" alt="Harman Sohanpal" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Harman Sohanpal</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div><p class="body-opensans-size-9" data-v-996dafb6>He is still thinking what to write about him</p><div class="social-links" data-v-996dafb6><!----><!----><!----></div></div><hr data-v-996dafb6><div class="related-articles" data-v-996dafb6><div class="flex-space-between" data-v-996dafb6><p class="heading-size-7" data-v-996dafb6>_related articles</p><a href="/blogs" class="heading-size-9 underline" data-v-996dafb6>View all</a></div><div class="flex-space-between blog-card-wrapper" data-v-996dafb6><a href="/blogs/inserting-millions-of-records-in-java" class="blog-card" data-v-996dafb6><img src="/assets/img/image-2.646b7a73.png" alt="Inserting Millions of Records in Java: Strategies and Benchmarks" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Inserting Millions of Records in Java: Strategies and Benchmarks</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Kesavan   11 min read
            </p></div></a><a href="/blogs/scaling-royalty-payout-p2" class="blog-card" data-v-996dafb6><img src="/assets/img/default-cover.55254b66.png" alt="" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Scaling Royalty Payouts in Music Distribution: Challenges and Solutions from the Frontlines (Part 2)</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Harman Sohanpal   5 min read
            </p></div></a></div></div><div class="lets-talk" data-v-188e6a71><div class="message heading-size-7" data-v-188e6a71>
    Let’s build digital solutions together.
  </div><div class="action-container" data-v-188e6a71><div class="action-button heading-size-5" data-v-188e6a71><div data-v-188e6a71>Get in touch</div><div class="arrow" data-v-188e6a71>-&gt;</div></div><img src="/assets/img/talk.71d1d2f3.svg" alt="Lenny Face" data-v-188e6a71></div></div></div></div><div data-v-996dafb6></div></div><div id="footer" class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="site-footer" data-v-0a037a4b data-v-b5a9baaa><ul class="main-nav footer" data-v-244aa462 data-v-0a037a4b><div class="primary fadeIn" data-v-244aa462><li data-v-244aa462><a href="/music-biz" data-v-244aa462>/MusicBiz</a></li><li data-v-244aa462><a href="/genai" data-v-244aa462>/GenAI</a></li><li data-v-244aa462><a href="https://solutions.tarkalabs.com/design/" target="_self" data-v-244aa462>/Design</a></li><li data-v-244aa462><a href="/develop" data-v-244aa462>/Develop</a></li><li data-v-244aa462><a href="/case-studies" data-v-244aa462>
        /Case_Studies
      </a></li><li data-v-244aa462><a href="/careers" data-v-244aa462>/Careers</a></li><li data-v-244aa462><a href="/about" data-v-244aa462>/About</a></li><li data-v-244aa462><a href="/contact" data-v-244aa462>/Contact</a></li></div></ul><div class="subnav" data-v-0a037a4b><ul class="sub body-jetbrains-size-11 footer fadeIn" data-v-3cc3824e data-v-0a037a4b><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul><div data-v-fae945d8 data-v-0a037a4b><a href="https://twitter.com/tarkalabs" target="_blank" rel="noopener" class="external" data-v-fae945d8>Twitter</a><a href="https://in.linkedin.com/company/tarka-labs" target="_blank" rel="noopener" class="external" data-v-fae945d8>LinkedIn</a></div><div class="sedin" data-v-0a037a4b><a href="https://sedintechnologies.com/" target="_blank" rel="noopener" class="external" data-v-0a037a4b>Tarka Labs is a division of Sedin Technologies</a></div></div></div></div><div data-v-996dafb6></div></div></div></div></div>
    <script src="/assets/js/app.0797a3da.js" defer></script><script src="/assets/js/page--src--templates--blog-vue.80bca3bd.js" defer></script><script data-vue-tag="ssr" src="https://unpkg.com/@lottiefiles/lottie-player@0.4.0/dist/lottie-player.js" data-body="true"></script>
  </body>
</html>
