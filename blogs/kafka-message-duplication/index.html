<!DOCTYPE html>
<html data-html-server-rendered="true" lang="en" data-vue-tag="%7B%22lang%22:%7B%22ssr%22:%22en%22%7D%7D">
  <head>
    <title>Handling message duplication in Kafka · Tarka Labs - Tarka Labs</title><meta name="gridsome:hash" content="60b74391149c055e573d6fe1b193bd109fe517b8"><meta data-vue-tag="ssr" charset="utf-8"><meta data-vue-tag="ssr" name="generator" content="Gridsome v0.7.23"><meta data-vue-tag="ssr" data-key="viewport" name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"><meta data-vue-tag="ssr" data-key="format-detection" name="format-detection" content="telephone=no"><meta data-vue-tag="ssr" name="viewport" content="width=device-width, initial-scale=1.0"><meta data-vue-tag="ssr" property="og:title" content="Handling message duplication in Kafka · Tarka Labs"><meta data-vue-tag="ssr" property="og:description" content="Handling message duplication in Kafka"><meta data-vue-tag="ssr" property="og:image" content="/assets/img/kafka-message-duplication.30a6cddc.webp"><meta data-vue-tag="ssr" property="og:image:height" content="627"><meta data-vue-tag="ssr" property="og:image:width" content="1200"><link data-vue-tag="ssr" rel="icon" href="data:,"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="16x16" href="/assets/static/favicon.ce0531f.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="32x32" href="/assets/static/favicon.ac8d93a.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="icon" type="image/png" sizes="96x96" href="/assets/static/favicon.b9532cc.92f6d0f06feb6aec5e019521ff224fd8.png"><link data-vue-tag="ssr" rel="apple-touch-icon" type="image/png" sizes="76x76" href="/assets/static/favicon.f22e9f3.92f6d0f06feb6aec5e019521ff224fd8.png"><link rel="preload" href="/assets/css/0.styles.14fdcb10.css" as="style"><link rel="preload" href="/assets/js/app.328f1602.js" as="script"><link rel="preload" href="/assets/js/page--src--templates--blog-vue.ecffc636.js" as="script"><link rel="stylesheet" href="/assets/css/0.styles.14fdcb10.css"><noscript data-vue-tag="ssr"><style>.g-image--loading{display:none;}</style></noscript>
    <noscript>
      <div class="noscript-container">
        <a href="/" class="noscript-logo">Tarka <br />_Labs</a>
        <div class="noscript-text-container">
          <h1>Uh oh! Looks like <span>JavaScript</span> is disabled.</h1>
          <p>
            Bitman requires <span>JavaScript</span> to fuel his thirst to end
            bad UX and lazy design, which is necessary to give you the best
            viewing experience possible. Please enable it to continue to our
            website.
          </p>
        </div>
      </div>
    </noscript>
  </head>

  <body >
    <div><div id="app" data-server-rendered="true" data-v-b5a9baaa><div data-v-b5a9baaa><div id="banner-section" data-v-b5a9baaa><div class="banner" style="background:;display:none;" data-v-b5a9baaa><div class="layout" data-v-b5a9baaa><div data-v-b5a9baaa></div><div class="hero heading-size-5" style="color:#ffffff;" data-v-b5a9baaa></div><div data-v-b5a9baaa></div></div></div><div data-v-b5a9baaa></div></div><div class="sidebar" data-v-d6d2017e data-v-b5a9baaa><div class="nav" data-v-d6d2017e><div class="fixed" data-v-d6d2017e><a href="/" data-v-9b1a4c9c data-v-d6d2017e> TARKA<br data-v-9b1a4c9c>_LABS </a><div class="menu" data-v-50705736 data-v-d6d2017e><div class="control" style="stroke:black;" data-v-50705736><div class="spinner heading-size-9" data-v-48940e1e data-v-50705736><span class="side-menu-symbol" data-v-48940e1e><span class="menu-symbol rotate180t90" data-v-48940e1e><svg height="10" width="10" data-v-48940e1e><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-48940e1e></line></svg></span><span class="menu-symbol rotate90t0" data-v-48940e1e><svg height="10" width="10" data-v-48940e1e><line x1="0" y1="5" x2="10" y2="5" style="stroke-width: 2" data-v-48940e1e></line></svg></span></span><span class="Spinner-text" data-v-48940e1e> menu </span></div><div class="active-page body-jetbrains-size-11 fade-in" data-v-4767b8ae data-v-50705736>
  
</div></div><div class="items hidden" data-v-50705736><ul class="main-nav" data-v-20ea19cd data-v-50705736><div class="primary fadeOut sidebar" data-v-20ea19cd><li data-v-20ea19cd><a href="https://design.tarkalabs.com/" target="_self" data-v-20ea19cd>/Design</a></li><li data-v-20ea19cd><a href="/develop" data-v-20ea19cd>/Develop</a></li><li data-v-20ea19cd><a href="/projects" data-v-20ea19cd>/Case_Studies</a></li><li data-v-20ea19cd><a href="/careers" data-v-20ea19cd>/Careers</a></li><li data-v-20ea19cd><a href="/about" data-v-20ea19cd>/About</a></li><li data-v-20ea19cd><a href="/contact" data-v-20ea19cd>/Contact</a></li></div></ul><ul class="sub body-jetbrains-size-11 fadeOut sidebar" data-v-3cc3824e data-v-50705736><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul></div></div><a href="/contact" class="heading-size-9" data-v-573e12d8 data-v-d6d2017e>
  Get in<br data-v-573e12d8>touch<span class="arrow" data-v-573e12d8>-&gt;</span></a></div></div><!----></div><div class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="blog-details-page" data-v-996dafb6><div class="inner-section" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>
        /web - 5 min read
      </p><h1 class="title" data-v-996dafb6>Handling message duplication in Kafka</h1><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/vignesh.104602f3.png" alt="Vignesh Ravichandran" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Vignesh Ravichandran</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div></div><img src="/assets/img/kafka-message-duplication.30a6cddc.webp" alt="Handling message duplication in Kafka" class="header-img" data-v-996dafb6><div class="toc-wrapper" data-v-996dafb6><h2 class="heading-size-7" data-v-996dafb6>Table of contents</h2><div class="toc" data-v-996dafb6><a href="#content" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/01</p><p data-v-996dafb6>Intro</p></a><a href="#toc-section-1" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/02</p><p data-v-996dafb6>Producer side duplicate messages</p></a><a href="#toc-section-2" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/03</p><p data-v-996dafb6>Consumer side duplicate messages</p></a><a href="#toc-section-3" class="heading-size-9 heading" data-v-996dafb6><p data-v-996dafb6>/04</p><p data-v-996dafb6>Conclusion</p></a></div></div><div id="content" class="content" data-v-996dafb6><p>Imagine you are working on a large-scale e-commerce application which uses Kafka for messaging.
All seems to be going well until one fine day you look at your metrics dashboard and you start noticing an uptick in the number of deliveries compared to the number of orders placed.
This leaves your team scrambling for an answer. After hours of debugging and a lot of coffee, the root cause turns out to not be a coding error, but duplicate messages flooding your topics.
In this blog, we will do a deep dive into the scenarios that can lead to duplicates and the various approaches that can be used to avoid them.</p>
<h1 id="toc-section-1"><a href="#producer-side-duplicate-messages" aria-hidden="true"><span class="icon icon-link"></span></a>Producer side duplicate messages</h1>
<p>Let us consider an order service that publishes messages to an order topic.</p>
<img src="/blog/kafka-message-duplication/producer-1.webp">
<p>In step 3, it is possible for the acknowledgement from Kafka to be lost due to transient network issues, such as temporary loss of network connectivity.
This will lead the order service to retry the same message until a successful acknowledgement is received, resulting in a duplicate.</p>
<img src="/blog/kafka-message-duplication/producer-2.webp">
<h2 id="resolution-idempotent-producer"><a href="#resolution-idempotent-producer" aria-hidden="true"><span class="icon icon-link"></span></a>Resolution: Idempotent Producer</h2>
<p><a href="https://en.wikipedia.org/wiki/Idempotence" target="_blank" rel="nofollow noopener noreferrer">Idempotent</a> producer can help resolve the issue.
To achieve this, the order service should be assigned a unique producer ID (PID) and each message published should be given a sequence number.
The combination of PID and the sequence number is tracked by Kafka as a unique ID for a message.
So, when a retry happens for an existing message, Kafka gives an acknowledgement back without appending the message to the log.</p>
<img src="/blog/kafka-message-duplication/producer-3.webp">
<p><a href="https://kafka.apache.org/documentation/#producerconfigs_enable.idempotence" target="_blank" rel="nofollow noopener noreferrer">Idempotency can be enabled in Kafka producer</a> by setting
<code class="language-inline-text">enable.idempotence</code> configuration property to <code class="language-inline-text">true</code> , <code class="language-inline-text">retries</code> to a value greater than 0 and <code class="language-inline-text">acks</code> to <code class="language-inline-text">all</code>.</p>
<p><code class="language-inline-text">enable.idempotence</code> — When set to <code class="language-inline-text">true</code> , the producer automatically does retries on retryable errors.
These can be errors that are transient in nature, such as leader not available or not enough replicas.</p>
<p><code class="language-inline-text">acks</code> — When set to <code class="language-inline-text">all</code> , Kafka makes sure that the leader waits for minimum number of in-sync replica partitions to have acknowledged the message before sending an acknowledgement to the producer.</p>
<h1 id="toc-section-2"><a href="#consumer-side-duplicate-messages" aria-hidden="true"><span class="icon icon-link"></span></a>Consumer side duplicate messages</h1>
<p>Now, let us consider a fulfillment service which:</p>
<ol>
<li>Reads messages from the Order Topic.</li>
<li>Performs a POST call to the Audit Service.</li>
<li>Creates a new record in the Fulfillment Table.</li>
<li>Publishes a message to the Fulfillment Topic.</li>
<li>Updates the offset in Kafka.</li>
</ol>
<img src="/blog/kafka-message-duplication/consumer-1.webp">
<p>If the instance running the service, does not process steps 2–5 within the set timeout, Kafka will assume that the service is dead.
This will cause the service instance to be removed from the consumer group and the partition to be rebalanced.
This means, the same message will then be assigned to, and processed by, another consumer in the group.</p>
<h2 id="resolution-idempotent-consumer"><a href="#resolution-idempotent-consumer" aria-hidden="true"><span class="icon icon-link"></span></a>Resolution: Idempotent Consumer</h2>
<p>Tracking all successfully consumed messages can help to avoid this scenario.
This can be achieved by assigning a unique ID to every message created at the producer side (order service),
and tracking them on the consumer side (fulfillment service) by storing each ID in a database table (Message ID Tracking Table).
When a message with a duplicate ID is received(identified by searching the Message ID Tracking Table), the offset is immediately updated and further processing skipped.</p>
<img src="/blog/kafka-message-duplication/consumer-2.webp">
<p>Also, inserting the record into the Tracking and Fulfillment Tables should done as a DB transaction.
This ensures that both actions are rollbacked in the event of any failure.</p>
<p><a href="https://stackoverflow.com/questions/62266911/jpa-stop-executing-code-in-transaction-if-exception-occurs" target="_blank" rel="nofollow noopener noreferrer">There is a possibility for transaction to fail, after publishing message to the fulfillment topic.</a>
This will lead to a retry, which will then result in a duplicate message in the fulfillment topic.
This approach does not address this scenario.</p>
<h2 id="resolution-idempotent-consumer--transactional-outbox"><a href="#resolution-idempotent-consumer--transactional-outbox" aria-hidden="true"><span class="icon icon-link"></span></a>Resolution: Idempotent Consumer + Transactional Outbox</h2>
<p>It is not possible to have a distributed transaction that would span the database as well as Kafka, as the latter does not support XA transactions.
So an approach to resolve the issue, will be to have an outbox table for capturing events to be published.
Writes to this table should be included in the same DB transaction which writes to the Tracking and Fulfillment tables.</p>
<img src="/blog/kafka-message-duplication/consumer-3.webp">
<p>This ensures database writes, and message publishing to Kafka, are an atomic action.
By using a Change Data Capture (CDC) tool, such as Kafka Connect or <a href="https://debezium.io/" target="_blank" rel="nofollow noopener noreferrer">Debezium</a>, the event can then be published to the fulfillment topic.</p>
<p>Even with this approach, there is a still a possibility for duplicate POST calls,
since retires can be triggered when there is a <a href="https://stackoverflow.com/questions/62266911/jpa-stop-executing-code-in-transaction-if-exception-occurs" target="_blank" rel="nofollow noopener noreferrer">transaction failure followed by a rollback after the making the call</a>.
This is irrespective of the order of execution of the call. The only resolution for which, will be to make sure that the POST call is idempotent on the receiver side.</p>
<h1 id="toc-section-3"><a href="#conclusion" aria-hidden="true"><span class="icon icon-link"></span></a>Conclusion</h1>
<p>These approaches introduce a lot of moving parts which increase complexity and maintainability.
So, it will be wise to take an incremental approach and implement them only when there are substantial metrics to support their incorporation.</p>
</div><hr data-v-996dafb6><div class="inner-section" data-v-996dafb6><div class="author-basic-info" data-v-996dafb6><img src="/assets/img/vignesh.104602f3.png" alt="Vignesh Ravichandran" width="64" data-v-996dafb6><div data-v-996dafb6><p class="heading-size-9 capitalize" data-v-996dafb6>Vignesh Ravichandran</p><p class="body-jetbrains-size-10" data-v-996dafb6>
            Developer
          </p></div></div><p class="body-opensans-size-9" data-v-996dafb6></p><div class="social-links" data-v-996dafb6><!----><!----><a href="https://medium.com/@vignesh-ravichandran" target="_blank" class="heading-size-9" data-v-996dafb6>
          Medium
        </a></div></div><hr data-v-996dafb6><div class="related-articles" data-v-996dafb6><div class="flex-space-between" data-v-996dafb6><p class="heading-size-7" data-v-996dafb6>_related articles</p><a href="/blogs" class="heading-size-9 underline" data-v-996dafb6>View all</a></div><div class="flex-space-between blog-card-wrapper" data-v-996dafb6><a href="/blogs/go-dto-pattern" class="blog-card" data-v-996dafb6><img src="/assets/img/go-dto-pattern.4d5aa661.webp" alt="Leveraging DTO pattern in Go-based web apps" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Leveraging DTO pattern in Go-based web apps</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Shamil Siddique   4 min read
            </p></div></a><a href="/blogs/generic-callbacks-rust" class="blog-card" data-v-996dafb6><img src="/assets/img/generic-callbacks-rust.5686d2e2.webp" alt="Generic Callbacks in Rust" class="thumbnail" data-v-996dafb6><div class="info" data-v-996dafb6><p class="heading-size-10 capitalize" data-v-996dafb6>/web</p><h3 data-v-996dafb6>Generic Callbacks in Rust</h3><p class="body-jetbrains-size-10" data-v-996dafb6>
              Dhruva Sagar   3 min read
            </p></div></a></div></div><div class="lets-talk" data-v-188e6a71><div class="message heading-size-7" data-v-188e6a71>
    Let’s build digital solutions together.
  </div><div class="action-container" data-v-188e6a71><div class="action-button heading-size-5" data-v-188e6a71><div data-v-188e6a71>Get in touch</div><div class="arrow" data-v-188e6a71>-&gt;</div></div><img src="/assets/img/talk.71d1d2f3.svg" alt="Lenny Face" data-v-188e6a71></div></div></div></div><div data-v-996dafb6></div></div><div id="footer" class="baseLayout" data-v-996dafb6 data-v-b5a9baaa><div data-v-996dafb6></div><div data-v-996dafb6><div class="site-footer" data-v-0a037a4b data-v-b5a9baaa><ul class="main-nav footer" data-v-20ea19cd data-v-0a037a4b><div class="primary fadeIn" data-v-20ea19cd><li data-v-20ea19cd><a href="https://design.tarkalabs.com/" target="_self" data-v-20ea19cd>/Design</a></li><li data-v-20ea19cd><a href="/develop" data-v-20ea19cd>/Develop</a></li><li data-v-20ea19cd><a href="/projects" data-v-20ea19cd>/Case_Studies</a></li><li data-v-20ea19cd><a href="/careers" data-v-20ea19cd>/Careers</a></li><li data-v-20ea19cd><a href="/about" data-v-20ea19cd>/About</a></li><li data-v-20ea19cd><a href="/contact" data-v-20ea19cd>/Contact</a></li></div></ul><div class="subnav" data-v-0a037a4b><ul class="sub body-jetbrains-size-11 footer fadeIn" data-v-3cc3824e data-v-0a037a4b><li data-v-3cc3824e><a href="/blogs" class="active" data-v-3cc3824e>/blogs</a></li><li data-v-3cc3824e><a href="/talks" data-v-3cc3824e>/talks</a></li><li data-v-3cc3824e><a href="/train" data-v-3cc3824e>/train</a></li></ul><div data-v-fae945d8 data-v-0a037a4b><a href="https://twitter.com/tarkalabs" target="_blank" rel="noopener" class="external" data-v-fae945d8>Twitter</a><a href="https://in.linkedin.com/company/tarka-labs" target="_blank" rel="noopener" class="external" data-v-fae945d8>LinkedIn</a></div><div class="sedin" data-v-0a037a4b><a href="https://sedintechnologies.com/" target="_blank" rel="noopener" class="external" data-v-0a037a4b>Tarka Labs is a division of Sedin Technologies</a></div></div></div></div><div data-v-996dafb6></div></div></div></div></div>
    <script>window.__INITIAL_STATE__={"data":{"blog":{"id":"fc9594b07b671d9babc60a4f5b40aeff","slug":"kafka-message-duplication","content":"\u003Cp\u003EImagine you are working on a large-scale e-commerce application which uses Kafka for messaging.\nAll seems to be going well until one fine day you look at your metrics dashboard and you start noticing an uptick in the number of deliveries compared to the number of orders placed.\nThis leaves your team scrambling for an answer. After hours of debugging and a lot of coffee, the root cause turns out to not be a coding error, but duplicate messages flooding your topics.\nIn this blog, we will do a deep dive into the scenarios that can lead to duplicates and the various approaches that can be used to avoid them.\u003C\u002Fp\u003E\n\u003Ch1 id=\"toc-section-1\"\u003E\u003Ca href=\"#producer-side-duplicate-messages\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EProducer side duplicate messages\u003C\u002Fh1\u003E\n\u003Cp\u003ELet us consider an order service that publishes messages to an order topic.\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fblog\u002Fkafka-message-duplication\u002Fproducer-1.webp\"\u003E\n\u003Cp\u003EIn step 3, it is possible for the acknowledgement from Kafka to be lost due to transient network issues, such as temporary loss of network connectivity.\nThis will lead the order service to retry the same message until a successful acknowledgement is received, resulting in a duplicate.\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fblog\u002Fkafka-message-duplication\u002Fproducer-2.webp\"\u003E\n\u003Ch2 id=\"resolution-idempotent-producer\"\u003E\u003Ca href=\"#resolution-idempotent-producer\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EResolution: Idempotent Producer\u003C\u002Fh2\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FIdempotence\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EIdempotent\u003C\u002Fa\u003E producer can help resolve the issue.\nTo achieve this, the order service should be assigned a unique producer ID (PID) and each message published should be given a sequence number.\nThe combination of PID and the sequence number is tracked by Kafka as a unique ID for a message.\nSo, when a retry happens for an existing message, Kafka gives an acknowledgement back without appending the message to the log.\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fblog\u002Fkafka-message-duplication\u002Fproducer-3.webp\"\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fkafka.apache.org\u002Fdocumentation\u002F#producerconfigs_enable.idempotence\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EIdempotency can be enabled in Kafka producer\u003C\u002Fa\u003E by setting\n\u003Ccode class=\"language-inline-text\"\u003Eenable.idempotence\u003C\u002Fcode\u003E configuration property to \u003Ccode class=\"language-inline-text\"\u003Etrue\u003C\u002Fcode\u003E , \u003Ccode class=\"language-inline-text\"\u003Eretries\u003C\u002Fcode\u003E to a value greater than 0 and \u003Ccode class=\"language-inline-text\"\u003Eacks\u003C\u002Fcode\u003E to \u003Ccode class=\"language-inline-text\"\u003Eall\u003C\u002Fcode\u003E.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode class=\"language-inline-text\"\u003Eenable.idempotence\u003C\u002Fcode\u003E — When set to \u003Ccode class=\"language-inline-text\"\u003Etrue\u003C\u002Fcode\u003E , the producer automatically does retries on retryable errors.\nThese can be errors that are transient in nature, such as leader not available or not enough replicas.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ccode class=\"language-inline-text\"\u003Eacks\u003C\u002Fcode\u003E — When set to \u003Ccode class=\"language-inline-text\"\u003Eall\u003C\u002Fcode\u003E , Kafka makes sure that the leader waits for minimum number of in-sync replica partitions to have acknowledged the message before sending an acknowledgement to the producer.\u003C\u002Fp\u003E\n\u003Ch1 id=\"toc-section-2\"\u003E\u003Ca href=\"#consumer-side-duplicate-messages\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EConsumer side duplicate messages\u003C\u002Fh1\u003E\n\u003Cp\u003ENow, let us consider a fulfillment service which:\u003C\u002Fp\u003E\n\u003Col\u003E\n\u003Cli\u003EReads messages from the Order Topic.\u003C\u002Fli\u003E\n\u003Cli\u003EPerforms a POST call to the Audit Service.\u003C\u002Fli\u003E\n\u003Cli\u003ECreates a new record in the Fulfillment Table.\u003C\u002Fli\u003E\n\u003Cli\u003EPublishes a message to the Fulfillment Topic.\u003C\u002Fli\u003E\n\u003Cli\u003EUpdates the offset in Kafka.\u003C\u002Fli\u003E\n\u003C\u002Fol\u003E\n\u003Cimg src=\"\u002Fblog\u002Fkafka-message-duplication\u002Fconsumer-1.webp\"\u003E\n\u003Cp\u003EIf the instance running the service, does not process steps 2–5 within the set timeout, Kafka will assume that the service is dead.\nThis will cause the service instance to be removed from the consumer group and the partition to be rebalanced.\nThis means, the same message will then be assigned to, and processed by, another consumer in the group.\u003C\u002Fp\u003E\n\u003Ch2 id=\"resolution-idempotent-consumer\"\u003E\u003Ca href=\"#resolution-idempotent-consumer\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EResolution: Idempotent Consumer\u003C\u002Fh2\u003E\n\u003Cp\u003ETracking all successfully consumed messages can help to avoid this scenario.\nThis can be achieved by assigning a unique ID to every message created at the producer side (order service),\nand tracking them on the consumer side (fulfillment service) by storing each ID in a database table (Message ID Tracking Table).\nWhen a message with a duplicate ID is received(identified by searching the Message ID Tracking Table), the offset is immediately updated and further processing skipped.\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fblog\u002Fkafka-message-duplication\u002Fconsumer-2.webp\"\u003E\n\u003Cp\u003EAlso, inserting the record into the Tracking and Fulfillment Tables should done as a DB transaction.\nThis ensures that both actions are rollbacked in the event of any failure.\u003C\u002Fp\u003E\n\u003Cp\u003E\u003Ca href=\"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F62266911\u002Fjpa-stop-executing-code-in-transaction-if-exception-occurs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EThere is a possibility for transaction to fail, after publishing message to the fulfillment topic.\u003C\u002Fa\u003E\nThis will lead to a retry, which will then result in a duplicate message in the fulfillment topic.\nThis approach does not address this scenario.\u003C\u002Fp\u003E\n\u003Ch2 id=\"resolution-idempotent-consumer--transactional-outbox\"\u003E\u003Ca href=\"#resolution-idempotent-consumer--transactional-outbox\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EResolution: Idempotent Consumer + Transactional Outbox\u003C\u002Fh2\u003E\n\u003Cp\u003EIt is not possible to have a distributed transaction that would span the database as well as Kafka, as the latter does not support XA transactions.\nSo an approach to resolve the issue, will be to have an outbox table for capturing events to be published.\nWrites to this table should be included in the same DB transaction which writes to the Tracking and Fulfillment tables.\u003C\u002Fp\u003E\n\u003Cimg src=\"\u002Fblog\u002Fkafka-message-duplication\u002Fconsumer-3.webp\"\u003E\n\u003Cp\u003EThis ensures database writes, and message publishing to Kafka, are an atomic action.\nBy using a Change Data Capture (CDC) tool, such as Kafka Connect or \u003Ca href=\"https:\u002F\u002Fdebezium.io\u002F\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003EDebezium\u003C\u002Fa\u003E, the event can then be published to the fulfillment topic.\u003C\u002Fp\u003E\n\u003Cp\u003EEven with this approach, there is a still a possibility for duplicate POST calls,\nsince retires can be triggered when there is a \u003Ca href=\"https:\u002F\u002Fstackoverflow.com\u002Fquestions\u002F62266911\u002Fjpa-stop-executing-code-in-transaction-if-exception-occurs\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"\u003Etransaction failure followed by a rollback after the making the call\u003C\u002Fa\u003E.\nThis is irrespective of the order of execution of the call. The only resolution for which, will be to make sure that the POST call is idempotent on the receiver side.\u003C\u002Fp\u003E\n\u003Ch1 id=\"toc-section-3\"\u003E\u003Ca href=\"#conclusion\" aria-hidden=\"true\"\u003E\u003Cspan class=\"icon icon-link\"\u003E\u003C\u002Fspan\u003E\u003C\u002Fa\u003EConclusion\u003C\u002Fh1\u003E\n\u003Cp\u003EThese approaches introduce a lot of moving parts which increase complexity and maintainability.\nSo, it will be wise to take an incremental approach and implement them only when there are substantial metrics to support their incorporation.\u003C\u002Fp\u003E\n"},"blogs":{"edges":[{"node":{"tag":"consulting","title":"Navigating Change: The BA's Role in Managing Agile Transformations","description":"Navigating change: The BA's Role in Managing Agile Transformations","duration":"3 min read","thumbnail_alt":"Navigating change: The BA's Role in Managing Agile Transformations","slug":"navigating-change","tarkan":{"name":"Sparsh Gupta","role":"Product Owner","image":"sparsh.png","blurb":"She is still thinking what to write about her","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@sparsh28"}},"coverImage":"navigating-change\u002Fnavigating-change.webp"}},{"node":{"tag":"ai","title":"Extracting Structured Data from PDFs with Claude Sonnet and Amazon Bedrock","description":"Extracting Structured Data from PDFs with Claude Sonnet and Amazon Bedrock","duration":"7 min read","thumbnail_alt":"Extracting Structured Data from PDFs with Claude Sonnet and Amazon Bedrock","slug":"extracting-structured-data","tarkan":{"name":"Kesavan","role":"Developer","image":"k7.png","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@itzk7"}},"coverImage":""}},{"node":{"tag":"web","title":"Leveraging DTO pattern in Go-based web apps","description":"Leveraging DTO pattern in Go-based web apps","duration":"4 min read","thumbnail_alt":"Leveraging DTO pattern in Go-based web apps","slug":"go-dto-pattern","tarkan":{"name":"Shamil Siddique","role":"Developer","image":"shamil.png","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@shamilsdq"}},"coverImage":"go-dto-pattern\u002Fgo-dto-pattern.webp"}},{"node":{"tag":"web","title":"Handling message duplication in Kafka","description":"Handling message duplication in Kafka","duration":"5 min read","thumbnail_alt":"Handling message duplication in Kafka","slug":"kafka-message-duplication","tarkan":{"name":"Vignesh Ravichandran","role":"Developer","image":"vignesh.png","blurb":"","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@vignesh-ravichandran"}},"coverImage":"kafka-message-duplication\u002Fkafka-message-duplication.webp"}},{"node":{"tag":"web","title":"Generic Callbacks in Rust","description":"Generic Callbacks in Rust","duration":"3 min read","thumbnail_alt":"Generic Callbacks in Rust","slug":"generic-callbacks-rust","tarkan":{"name":"Dhruva Sagar","role":"Developer","image":"dhruva.jpg","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@dhruvasagar"}},"coverImage":"generic-callbacks-rust\u002Fgeneric-callbacks-rust.webp"}},{"node":{"tag":"ai","title":"Implementing Serverless Batch Transcription with AWS Step Functions and Azure AI Services","description":"Implementing Serverless Batch Transcription with AWS Step Functions and Azure AI Services","duration":"8 min read","thumbnail_alt":"Implementing Serverless Batch Transcription with AWS Step Functions and Azure AI Services","slug":"batch-transcription","tarkan":{"name":"Kesavan","role":"Developer","image":"k7.png","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@itzk7"}},"coverImage":"batch-transcription\u002Fbatch-transcription.webp"}},{"node":{"tag":"consulting","title":"Documentation: Yes, We Should!","description":"Imagine you recently joined a new team, and after a couple of weeks, you were assigned a bug ticket. You look at the ticket and decide to see if this issue surfaced in the past and so do a search in the bug tracking tool.","duration":"4 min read","thumbnail_alt":"A 3D image of a file folder with purple, yellow and green color rectangles for pages","slug":"documentation-yes-we-should","tarkan":{"name":"Jahangir Anwari","role":"Developer","image":"jahangir.jpeg","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@janwari"}},"coverImage":"documentation-yes-we-should\u002Fdocumentation-yes-we-should.png"}},{"node":{"tag":"consulting","title":"Building Serious Software","description":"Do you know what every software startup entrepreneur dreams of after they validate the market? Software that does not break with scale and is adaptable to change.","duration":"4 min read","thumbnail_alt":"A cartoon of loosely held blocks which are held by stick figures from collapsing","slug":"building-serious-software","tarkan":{"name":"Sudhakar Rayavaram","role":"Developer","image":"sudhakar.jpg","blurb":"Programming is overrated. I mean, there is more to solving a real world problem than writing code","socials":{"twitter":"","linkedin":"https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Fsudocker\u002F","medium":"https:\u002F\u002Fmedium.com\u002F@suDocker"}},"coverImage":"building-serious-software\u002Fbanner.png"}},{"node":{"tag":"consulting","title":"Wait! Don't write code yet","description":"As developers, it is necessary to understand how the code we write helps solve real-world problems. Often, it is easier to think about users while writing the application layer of code.","duration":"3 min read","thumbnail_alt":"A isometric image of a 3D maze","slug":"wait-dont-write-code-yet","tarkan":{"name":"Vidhya Desikan","role":"Developer","image":"vidhya.png","blurb":"","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@vdviddin"}},"coverImage":"wait-dont-write-code-yet\u002Fwait-dont-write-code-yet.png"}},{"node":{"tag":"consulting","title":"What does a CTO do?","description":"There has been a lot of hand-wringing and discussions about what a CTO does on the interwebs. Does a CTO write code? Does a CTO's calendar look like it is on the maker's or the manager's schedule? Does a CTO sit in on interviews?","duration":"6 min read","thumbnail_alt":"A isometric image of a balancing scale with code on one side and detective lens on the other side","slug":"what-does-a-cto-do","tarkan":{"name":"Vagmi Mudumbai","role":"Developer","image":"vagmi.jpg","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fvagmi.medium.com\u002F"}},"coverImage":"what-does-a-cto-do\u002Fcover.png"}},{"node":{"tag":"careers","title":"A writer's guide to working in a tech consultancy","description":"A manual for writers who work with cross-functional teams or roles.","duration":"4 min read","thumbnail_alt":"A circular red shape surrounded by cubes","slug":"a-writers-guide-to-working-in-a-tech-consultancy","tarkan":{"name":"Puneetha Jagannathan","role":"Brand Communications Specialist","image":"puneetha.jpg","blurb":"She is still thiking what to write about her","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fpuneetha-j.medium.com\u002F"}},"coverImage":"a-writers-guide-to-working-in-a-tech-consultancy\u002Fa-writers-guide-to-working-in-a-tech-consultancy.png"}},{"node":{"tag":"careers","title":"Our Guide To Hiring Great People","description":"How Tarka Labs approaches hiring.","duration":"5 min read","thumbnail_alt":"Colors in geometric shapes with hand-drawn sketches on them","slug":"our-guide-to-hiring-great-people","tarkan":{"name":"Jenifa Newlin","role":"People Champion","image":"jenifa.jpg","blurb":"She is still thinking what to write about her","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@jenifa_85990"}},"coverImage":"our-guide-to-hiring-great-people\u002Four-guide-to-hiring-great-people.png"}},{"node":{"tag":"mobile","title":"Debounce in Swift","description":"All about debounce: 4 ways to achieve debounce in Swift","duration":"5 min read","thumbnail_alt":"A representation of a function called 'debounce' which is accepting, as input, a green circle labelled '3' and outputting an identical-looking green circle with no label","slug":"debounce-in-swift","tarkan":{"name":"Pavan Kumar C","role":"iOS Developer","image":"pavan.jpg","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fpavankumarchalla.medium.com\u002F"}},"coverImage":""}},{"node":{"tag":"web","title":"Javascript Sandbox for your Node Project","description":"Guide to safely run customer javascript code in your node.js environment using vm2.","duration":"3 min read","thumbnail_alt":"Sandbox with a pail and shovel","slug":"javascript-sandbox-for-your-node-project","tarkan":{"name":"Utkarsh Mehta","role":"Developer","image":"bitman.png","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Flife-of-utkarsh.medium.com\u002F"}},"coverImage":"javascript-sandbox-for-your-node-project\u002Fjavascript-sandbox-for-your-node-project.png"}},{"node":{"tag":"web","title":"Know Kubernetes - Pictorially","description":"Understand kubernetes and its components with easily relatable pictorial representations.","duration":"7 min read","thumbnail_alt":"Black and white sketch of a square room labelled 'MASTER' with the following items: disk pack, chest of drawers with a wifi signal-emitting device on top, and two tables","slug":"know-kubernetes-pictorially","tarkan":{"name":"Sudhakar Rayavaram","role":"Developer","image":"sudhakar.jpg","blurb":"Programming is overrated. I mean, there is more to solving a real world problem than writing code","socials":{"twitter":"","linkedin":"https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Fsudocker\u002F","medium":"https:\u002F\u002Fmedium.com\u002F@suDocker"}},"coverImage":""}},{"node":{"tag":"mobile","title":"Why flutter","description":"Look beyond react native and why flutter is exciting.","duration":"5 min read","thumbnail_alt":"A hummingbird in flight","slug":"why-flutter","tarkan":{"name":"Vagmi Mudumbai","role":"Developer","image":"vagmi.jpg","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fvagmi.medium.com\u002F"}},"coverImage":"why-flutter\u002Fwhy-flutter.png"}},{"node":{"tag":"careers","title":"How we hire engineers","description":"How Tarka Labs hires engineers. Published in the interest of transparency.","duration":"3 min read","thumbnail_alt":"A dark room with two empty chairs facing each other across a table","slug":"how-we-hire-engineers","tarkan":{"name":"Vagmi Mudumbai","role":"Developer","image":"vagmi.jpg","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fvagmi.medium.com\u002F"}},"coverImage":"how-we-hire-engineers\u002Fhow-we-hire-engineers.png"}},{"node":{"tag":"web","title":"Power of SSH Tunneling","description":"Most developers spend a considerable amount of their time ssh'd into remote machines, however, few are aware of the power of ssh tunnels.","duration":"4 min read","thumbnail_alt":"Silhouette of a man standing inside a glowing blue tunnel with a glowing white circle in front of him","slug":"power-of-ssh-tunneling","tarkan":{"name":"Dhruva Sagar","role":"Developer","image":"dhruva.jpg","blurb":"He is still thinking what to write about him","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@dhruvasagar"}},"coverImage":"power-of-ssh-tunneling\u002Fpower-of-ssh-tunneling.png"}},{"node":{"tag":"careers","title":"All in one's mind.","description":"The effectiveness of a positive mindset and the ability to self-assess.","duration":"4 min read","thumbnail_alt":"A growing plant is layered over the artwork of a human brain","slug":"all-in-ones-mind","tarkan":{"name":"Ramya Raghavan","role":"A tarkan","image":"bitman.png","blurb":"She is still thiking what to write about her","socials":{"twitter":"","linkedin":"","medium":"https:\u002F\u002Fmedium.com\u002F@ramyaraghavan"}},"coverImage":"all-in-ones-mind\u002Fonion.webp"}}]}},"context":{}};(function(){var s;(s=document.currentScript||document.scripts[document.scripts.length-1]).parentNode.removeChild(s);}());</script><script src="/assets/js/app.328f1602.js" defer></script><script src="/assets/js/page--src--templates--blog-vue.ecffc636.js" defer></script><script data-vue-tag="ssr" src="https://unpkg.com/@lottiefiles/lottie-player@0.4.0/dist/lottie-player.js" data-body="true"></script>
  </body>
</html>
